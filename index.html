<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hello, willkernel" />





  <link rel="alternate" href="/atom.xml" title="willkernel" type="application/atom+xml" />






<meta name="description" content="Lifelong learning">
<meta property="og:type" content="website">
<meta property="og:title" content="willkernel">
<meta property="og:url" content="http://willkernel.github.io/index.html">
<meta property="og:site_name" content="willkernel">
<meta property="og:description" content="Lifelong learning">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="willkernel">
<meta name="twitter:description" content="Lifelong learning">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://willkernel.github.io/"/>





  <title>willkernel</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f0ba7422bc693773b5324bdb08f0cbe6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">willkernel</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Lifelong learning</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/04/08/CPP-一/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/08/CPP-一/" itemprop="url">C++(一)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-08T08:16:00+08:00">
                2018-04-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/08/CPP-一/" class="leancloud_visitors" data-flag-title="C++(一)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><blockquote>
<p>C++ 是一种静态类型的、编译式的、通用的、大小写敏感的、不规则的编程语言，支持过程化编程、面向对象编程和泛型编程<br>C++ 被认为是一种中级语言，它综合了高级语言和低级语言的特点<br>C++ 是由 Bjarne Stroustrup 于 1979 年在贝尔实验室开始设计开发的。C++ 进一步扩充和完善C,是 C 的一个超集，事实上，任何合法的 C 程序都是合法的 C++ 程序<br>注意：使用静态类型的编程语言是在编译时执行类型检查，而不是在运行时执行类型检查<br>2014    ISO/IEC 14882:2014    C++14    第四个C++标准</p>
</blockquote>
<blockquote>
<p>C++ 完全支持面向对象的程序设计，包括面向对象开发的四大特性：<br>封装<br>抽象<br>继承<br>多态</p>
</blockquote>
<blockquote>
<p>标准库<br>标准的 C++ 由三个重要部分组成：<br>核心语言，提供了所有构件块，包括变量、数据类型和常量，等等。<br>C++ 标准库，提供了大量的函数，用于操作文件、字符串等。<br>标准模板库（STL），提供了大量的方法，用于操作数据结构等</p>
</blockquote>
<ul>
<li><a href="https://sourceforge.net/projects/mingw/files/" target="_blank" rel="noopener">MinGW</a></li>
</ul>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><ul>
<li><p>程序结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"> </span><br><span class="line">// main() 是程序开始执行的地方 ，单行注释</span><br><span class="line"> </span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">   cout &lt;&lt; &quot;Hello World&quot;; // 输出 Hello World</span><br><span class="line">   return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>包含头文件<code>&lt;iostream&gt;</code></li>
<li><code>using namespace std;</code>使用std命名空间</li>
<li><code>int main()</code>主函数，程序从这里开始执行</li>
<li><code>return 0</code> 终止main()函数，返回0</li>
</ul>
</li>
<li><p>编译执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ touch hello.cpp</span><br><span class="line">$ g++ hello.cpp</span><br><span class="line">$ ./a.exe</span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure>
</li>
<li><p>分号&amp;快</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x = y; y = y+1; add(x, y);</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">   cout &lt;&lt; &quot;Hello World&quot;; // 输出 Hello World</span><br><span class="line">   return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>标识符以字母 A-Z 或 a-z 或下划线 _ 开始，后跟零个或多个字母，数字，下划线,不允许出现标点字符，比如 @、&amp; 和 %，区分大小写的编程语言</p>
</li>
<li>关键字<img src="http://p4n1d4izv.bkt.clouddn.com/images/cpp-keywords.png"></li>
<li><p>注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/* 用于输出 Hello World 的注释</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; &quot;Hello World&quot;; // 输出 Hello World</span><br><span class="line"></span><br><span class="line">#if 0 ... #endif 来实现注释，且可以实现嵌套，格式为：</span><br><span class="line">#if 0</span><br><span class="line">   code</span><br><span class="line">#endif </span><br><span class="line">你可以把 #if 0 改成 #if 1 来执行 code 的代码，测试时使用 #if 1 来执行测试代码，发布后使用 #if 0 来屏蔽测试代码</span><br><span class="line">#if 后可以是任意的条件语句</span><br></pre></td></tr></table></figure>
</li>
<li><p>C++中”\n”与endl的区别</p>
<blockquote>
<p>“\n” 表示内容为一个回车符的字符串。std::endl 是流操作子，输出的作用和输出 “\n” 类似，但可能略有区别。<br>std::endl 输出一个换行符，并立即刷新缓冲区。<br>例如:<br>std::cout &lt;&lt; std::endl;<br>相当于:<br>std::cout &lt;&lt; ‘\n’ &lt;&lt; std::flush;<br>或者<br>std::cout &lt;&lt; ‘\n’; std::fflush(stdout);<br>由于流操作符 &lt;&lt; 的重载，对于 ‘\n’ 和 “\n”，输出效果相同。<br>对于有输出缓冲的流（例如cout、clog），如果不手动进行缓冲区刷新操作，将在缓冲区满后自动刷新输出。不过对于 cout 来说（相对于文件输出流等），缓冲一般体现得并不明显。但是必要情况下使用 endl 代替 ‘\n’ 一般是个好习惯。<br>对于无缓冲的流（例如标准错误输出流cerr），刷新是不必要的，可以直接使用 ‘\n</p>
</blockquote>
</li>
</ul>
<h4 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h4><ul>
<li><img src="http://p4n1d4izv.bkt.clouddn.com/images/cpp-datatype.png">
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; &quot;bool: \t\t&quot; &lt;&lt; &quot;所占字节数：&quot; &lt;&lt; sizeof(bool);  </span><br><span class="line">cout &lt;&lt; &quot;\t最大值：&quot; &lt;&lt; (numeric_limits&lt;bool&gt;::max)();  </span><br><span class="line">cout &lt;&lt; &quot;\t\t最小值：&quot; &lt;&lt; (numeric_limits&lt;bool&gt;::min)() &lt;&lt; endl;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>它是一种 整型 类型，里面保存的是一个整数，就像 int, long 那样。这种整数用来记录一个大小(size)。size_t 的全称应该是 size type，就是说一种用来记录大小的数据类型,通常我们用 sizeof(XXX) 操作，这个操作所得到的结果就是 size_t 类型,因为 size_t 类型的数据其实是保存了一个整数，所以它也可以做加减乘除，也可以转化为 int 并赋值给 int 类型的变量,类似的还有 wchar_t, ptrdiff_t,wchar_t 就是 wide char type,一种用来记录一个宽字符的数据类型<br>ptrdiff_t 就是 pointer difference type， 一种用来记录两个指针之间的距离的数据类型<br>通常，size_t 和 ptrdiff_t 都是用 typedef 来实现的。你可能在某个头文件里面找到类似的语句<br>通常我们用 sizeof(XXX) 操作，这个操作所得到的结果就是 size_t 类型<br>因为 size_t 类型的数据其实是保存了一个整数，所以它也可以做加减乘除，也可以转化为 int 并赋值给 int 类型的变量<br>类似的还有 wchar_t, ptrdiff_t<br>wchar_t 就是 wide char type， 一种用来记录一个宽字符的数据类型<br>ptrdiff_t 就是 pointer difference type， 一种用来记录两个指针之间的距离的数据类型<br>通常，size_t 和 ptrdiff_t 都是用 typedef 来实现的。你可能在某个头文件里面找到类似的语句：<br>typedef unsigned int size_t;<br>而 wchar_t 则稍有不同。在一些旧的编译器中，wchar_t 也可能是用 typedef 来实现，但是新的标准中 wchar_t 已经是 C/C++ 语言的关键字，wchar_t 类型的地位已经和 char, int 的地位等同了。<br>在标准 C/C++ 的语法中，只有 int float char bool 等基本的数据类型，至于 size_t, 或 size_type 都是以后的编程人员为了方便记忆所定义的一些便于理解的由基本数据类型的变体类型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">typedef unsigned int size_t;</span><br><span class="line"></span><br><span class="line">int i;                   // 定义一个 int 类型的变量 i</span><br><span class="line">size_t size=sizeof(i);   // 用 sizeof 操作得到变量i的类型的大小</span><br><span class="line">// 这是一个size_t类型的值</span><br><span class="line">// 可以用来对一个size_t类型的变量做初始化</span><br><span class="line"></span><br><span class="line">i=(int)size;             // size_t 类型的值可以转化为 int 类型的值</span><br><span class="line">char c=&apos;a&apos;;              // c 保存了字符 a，占一个字节</span><br><span class="line">wchar_t wc=L&apos;a&apos;;         // wc 保存了宽字符 a，占两个字节</span><br><span class="line">// 注意 &apos;a&apos; 表示字符 a，L&apos;a&apos; 表示宽字符 a</span><br><span class="line"></span><br><span class="line">int arr[]=&#123;1,2,3,4,5&#125;;   // 定义一个数组</span><br><span class="line">int *p1=&amp;arr[0];         // 取得数组中元素的地址，赋值给指针</span><br><span class="line">int *p2=&amp;arr[3];</span><br><span class="line">ptrdiff_t diff=p2-p1;    // 指针的减法可以计算两个指针之间相隔的元素个数</span><br><span class="line">// 所得结果是一个 ptrdiff_t 类型</span><br><span class="line"></span><br><span class="line">i=(int)diff;             // ptrdiff_t 类型的值可以转化为 int 类型的值</span><br></pre></td></tr></table></figure></p>
</blockquote>
<ul>
<li>typedef 声明，定义已有类型别名<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef int feet;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>typedef 可以声明各种类型名，但不能用来定义变量。用 typedef 可以声明数组类型、字符串类型，使用比较方便。<br>用typedef只是对已经存在的类型增加一个类型名，而没有创造新的类型。<br>当在不同源文件中用到同一类型数据（尤其是像数组、指针、结构体、共用体等类型数据）时，常用 typedef 声明一些数据类型，把它们单独放在一个头文件中，然后在需要用到它们的文件中用 ＃include 命令把它们包含进来，以提高编程效率。<br>使用 typedef 有利于程序的通用与移植。有时程序会依赖于硬件特性，用 typedef 便于移植</p>
<ul>
<li>枚举<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">enum 枚举名&#123; </span><br><span class="line">     标识符[=整型常数], </span><br><span class="line">     标识符[=整型常数], </span><br><span class="line">... </span><br><span class="line">    标识符[=整型常数]</span><br><span class="line">&#125; 枚举变量;</span><br><span class="line"></span><br><span class="line">enum color &#123; red, green, blue &#125; c;</span><br><span class="line">c = blue;</span><br><span class="line"></span><br><span class="line">enum color &#123; red, green=5, blue &#125;;</span><br><span class="line">red值为0，green值为5，blue值为6</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><ul>
<li><p>变量类型</p>
<img src="http://p4n1d4izv.bkt.clouddn.com/images/cpp-vartype.png">
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">float  f, salary;</span><br><span class="line">double d;</span><br><span class="line">extern int d = 3, f = 5;    // d 和 f 的声明 </span><br><span class="line">int d = 3, f = 5;           // 定义并初始化 d 和 f</span><br><span class="line">byte z = 22;                // 定义并初始化 z</span><br><span class="line">char x = &apos;x&apos;;               // 变量 x 的值为 &apos;x&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>变量声明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"> </span><br><span class="line">// 变量声明</span><br><span class="line">extern int a, b;</span><br><span class="line">extern int c;</span><br><span class="line">extern float f;</span><br><span class="line">  </span><br><span class="line">int main ()</span><br><span class="line">&#123;</span><br><span class="line">  // 变量定义</span><br><span class="line">  int a, b;</span><br><span class="line">  int c;</span><br><span class="line">  float f;</span><br><span class="line"> </span><br><span class="line">  // 实际初始化</span><br><span class="line">  a = 10;</span><br><span class="line">  b = 20;</span><br><span class="line">  c = a + b;</span><br><span class="line"> </span><br><span class="line">  cout &lt;&lt; c &lt;&lt; endl ;</span><br><span class="line"> </span><br><span class="line">  f = 70.0/3.0;</span><br><span class="line">  cout &lt;&lt; f &lt;&lt; endl ;</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 函数声明</span><br><span class="line">int func();</span><br><span class="line"> </span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    // 函数调用</span><br><span class="line">    int i = func();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">// 函数定义</span><br><span class="line">int func()</span><br><span class="line">&#123;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>左值lvalue 右值Rvalues<br>左值（lvalue）：指向内存位置的表达式被称为左值（lvalue）表达式。左值可以出现在赋值号的左边或右边。<br>右值（rvalue）：术语右值（rvalue）指的是存储在内存中某些地址的数值。右值是不能对其进行赋值的表达式，也就是说，右值可以出现在赋值号的右边，但不能出现在赋值号的左边</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">有效表达式</span><br><span class="line">int g = 20;</span><br><span class="line">但是下面这个就不是一个有效的语句，会生成编译时错误：</span><br><span class="line">10 = 20;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>变量的类型间是可以互相转换的，转换又分为自动转换和强制转换<br>自动转换规则：<br>1、若参与运算量的类型不同，则先转换成同一类型，然后进行运算。<br>2、转换按数据长度增加的方向进行，以保证精度不降低。如int型和long型运算时，先把int量转成long型后再进行运算。<br>    a、若两种类型的字节数不同，转换成字节数高的类型<br>    b、若两种类型的字节数相同，且一种有符号，一种无符号，则转换成无符号类型<br>3、所有的浮点运算都是以双精度进行的，即使仅含float单精度量运算的表达式，也要先转换成double型，再作运算。<br>4、char型和short型参与运算时，必须先转换成int型。<br>5、在赋值运算中，赋值号两边量的数据类型不同时，赋值号右边量的类型将转换为左边量的类型。如果右边量的数据类型长度比左边长时，将丢失一部分数据，这样会降低精度:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int a=1;</span><br><span class="line">double b=2.5;</span><br><span class="line">a=b;</span><br><span class="line">cout &lt;&lt; a; //输出为 2，丢失小数部分</span><br><span class="line">int a = 1;</span><br><span class="line">double b = 2.1;</span><br><span class="line">cout &lt;&lt; &quot;a + b = &quot; &lt;&lt; a + b &lt;&lt; endl;  //输出为a + b = 3.1</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>强制转换规则：<br>强制类型转换是通过类型转换运算来实现的。其一般形式为：（类型说明符）（表达式）其功能是把表达式的运算结果强制转换成类型说明符所表示的类型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int a = 1;</span><br><span class="line">double b = 2.1;</span><br><span class="line">cout &lt;&lt; &quot;a + b = &quot; &lt;&lt; a + (int)b &lt;&lt; endl;  //输出为a + b = 3</span><br></pre></td></tr></table></figure></p>
</blockquote>
<ul>
<li>局部变量，全局变量<br>局部变量和全局变量的名称可以相同，但是在函数内，局部变量的值会覆盖全局变量的值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"> </span><br><span class="line">// 全局变量声明</span><br><span class="line">int g = 20;</span><br><span class="line"> </span><br><span class="line">int main ()</span><br><span class="line">&#123;</span><br><span class="line">  // 局部变量声明</span><br><span class="line">  int g = 10;</span><br><span class="line"> </span><br><span class="line">  cout &lt;&lt; g;</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>定义全局变量时，系统会自动初始化为下列值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int	0</span><br><span class="line">char	&apos;\0&apos;</span><br><span class="line">float	0</span><br><span class="line">double	0</span><br><span class="line">pointer	NULL</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>全局变量从定义处开始至程序结束起作用，即全局变量存在有效作用域<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">include&lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">     cout&lt;&lt;&quot;a= &quot;&lt;&lt;a&lt;&lt;endl; //编译不通过，a是未知字符</span><br><span class="line">     return 0;</span><br><span class="line">&#125;</span><br><span class="line">int a=10; //全局变量从此处定义</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>若要想让 main 函数也使用全局变量 a，可以用 extern 对全局变量进行声明，就可以合法使用了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">include&lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">     extern int a;</span><br><span class="line">     cout&lt;&lt;&quot;a= &quot;&lt;&lt;a&lt;&lt;endl; //合法，输出10</span><br><span class="line">     return 0;</span><br><span class="line">&#125;</span><br><span class="line">int a=10; //全局变量从此处定义</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h4><ul>
<li><p>整数常量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">85         // 十进制</span><br><span class="line">0213       // 八进制 </span><br><span class="line">0x4b       // 十六进制 </span><br><span class="line">30         // 整数 </span><br><span class="line">30u        // 无符号整数 </span><br><span class="line">30l        // 长整数 </span><br><span class="line">30ul       // 无符号长整数, U 和 L 的顺序任意</span><br></pre></td></tr></table></figure>
</li>
<li><p>浮点常量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">3.14159        // 合法的</span><br><span class="line">314159E-5L      // 合法的</span><br><span class="line">510E          // 非法的：不完整的指数</span><br><span class="line">210f          // 非法的：没有小数或指数</span><br><span class="line">.e55          // 非法的：缺少整数或分数</span><br></pre></td></tr></table></figure>
</li>
<li><p>布尔常量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">true 值代表真</span><br><span class="line">false 值代表假</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符常量</p>
<img src="http://p4n1d4izv.bkt.clouddn.com/images/cpp-charzy.png"></li>
<li><p>定义常量,不能修改赋值，定义时初始化<br>使用 #define 预处理器<br>使用 const 关键字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#define LENGTH 10   </span><br><span class="line">#define WIDTH  5</span><br><span class="line">#define NEWLINE &apos;\n&apos;</span><br><span class="line"></span><br><span class="line">const int  LENGTH = 10;</span><br><span class="line">const int  WIDTH  = 5;</span><br><span class="line">area = LENGTH * WIDTH;</span><br><span class="line">cout &lt;&lt; area;</span><br><span class="line">cout &lt;&lt; NEWLINE;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>宏定义 #define 和常量 const 的区别<br>类型和安全检查不同<br>宏定义是字符替换，没有数据类型的区别，同时这种替换没有类型安全检查，可能产生边际效应等错误；<br>const常量是常量的声明，有类型区别，需要在编译阶段进行类型检查<br>编译器处理不同<br>宏定义是一个”编译时”概念，在预处理阶段展开，不能对宏定义进行调试，生命周期结束与编译时期；<br>const常量是一个”运行时”概念，在程序运行使用，类似于一个只读行数据<br>存储方式不同<br>宏定义是直接替换，不会分配内存，存储与程序的代码段中；<br>const常量需要进行内存分配，存储与程序的数据段中<br>定义域不同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">void f1 ()</span><br><span class="line">&#123;</span><br><span class="line">    #define N 12</span><br><span class="line">    const int n 12;</span><br><span class="line"> &#125;</span><br><span class="line">void f2 ()</span><br><span class="line">&#123;</span><br><span class="line">    cout&lt;&lt;N &lt;&lt;endl; //正确，N已经定义过，不受定义域限制</span><br><span class="line">    cout&lt;&lt;n &lt;&lt;endl; //错误，n定义域只在f1函数中</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<blockquote>
<p>定义后能否取消<br>宏定义可以通过#undef来使之前的宏定义失效<br>const常量定义后将在定义域内永久有效<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">void f1()</span><br><span class="line">&#123;</span><br><span class="line">  #define N 12</span><br><span class="line">  const int n = 12;</span><br><span class="line"></span><br><span class="line">  #undef N //取消宏定义后，即使在f1函数中，N也无效了</span><br><span class="line">  #define N 21//取消后可以重新定义</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>宏定义不能作为参数传递给函数<br>const常量可以在函数的参数列表中出现</p>
</blockquote>
<h4 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h4><ul>
<li><p>修饰符 signed、unsigned、long 和 short 可应用于整型，signed 和 unsigned 可应用于字符型，long 可应用于双精度型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">   short int i;           // 有符号短整数</span><br><span class="line">   short unsigned int j;  // 无符号短整数</span><br><span class="line"> </span><br><span class="line">   j = 50000;</span><br><span class="line"> </span><br><span class="line">   i = j;</span><br><span class="line">   cout &lt;&lt; i &lt;&lt; &quot; &quot; &lt;&lt; j;</span><br><span class="line"> </span><br><span class="line">   return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-15536 50000</span><br></pre></td></tr></table></figure>
</li>
<li><p>const 类型的对象在程序执行期间不能被修改改变</p>
</li>
<li>volatile    修饰符 volatile 告诉编译器，变量的值可能以程序未明确指定的方式被改变</li>
<li>restrict    由 restrict 修饰的指针是唯一一种访问它所指向的对象的方式。只有 C99 增加了新的类型限定符 restrict</li>
<li>explicit构造函数是用来防止隐式转换的<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class Test1</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    Test1(int n)</span><br><span class="line">    &#123;</span><br><span class="line">        num=n;</span><br><span class="line">    &#125;//普通构造函数</span><br><span class="line">private:</span><br><span class="line">    int num;</span><br><span class="line">&#125;;</span><br><span class="line">class Test2</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    explicit Test2(int n)</span><br><span class="line">    &#123;</span><br><span class="line">        num=n;</span><br><span class="line">    &#125;//explicit(显式)构造函数</span><br><span class="line">private:</span><br><span class="line">    int num;</span><br><span class="line">&#125;;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    Test1 t1=12;//隐式调用其构造函数,成功</span><br><span class="line">    Test2 t2=12;//编译错误,不能隐式调用其构造函数</span><br><span class="line">    Test2 t2(12);//显式调用成功</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">普通构造函数能够被隐式调用。而explicit构造函数只能被显式调用</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="存储类"><a href="#存储类" class="headerlink" title="存储类"></a>存储类</h4><p>存储类定义程序中变量/函数的范围（可见性）和生命周期</p>
<ul>
<li>register  定义存储在寄存器中而不是 RAM 中的局部变量。这意味着变量的最大尺寸等于寄存器的大小（通常是一个词），且不能对它应用一元的 ‘&amp;’ 运算符（因为它没有内存位置）,寄存器只用于需要快速访问的变量，比如计数器。还应注意的是，定义 ‘register’ 并不意味着变量将被存储在寄存器中，它意味着变量可能存储在寄存器中，这取决于硬件和实现的限制</li>
<li><p>static 存储类指示编译器在程序的生命周期内保持局部变量的存在，而不需要在每次它进入和离开作用域时进行创建和销毁。因此，使用 static 修饰局部变量可以在函数调用之间保持局部变量的值。static 修饰符也可以应用于全局变量。当 static 修饰全局变量时，会使变量的作用域限制在声明它的文件内。在 C++ 中，当 static 用在类数据成员上时，会导致仅有一个该成员的副本被类的所有对象共享</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">// 函数声明 </span><br><span class="line">void func(void);</span><br><span class="line">static int count = 10; /* 全局变量 */</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    while(count--)</span><br><span class="line">    &#123;</span><br><span class="line">       func();</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">// 函数定义</span><br><span class="line">void func( void )</span><br><span class="line">&#123;</span><br><span class="line">    static int i = 5; // 局部静态变量</span><br><span class="line">    i++;</span><br><span class="line">    std::cout &lt;&lt; &quot;变量 i 为 &quot; &lt;&lt; i ;</span><br><span class="line">    std::cout &lt;&lt; &quot; , 变量 count 为 &quot; &lt;&lt; count &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">变量 i 为 6 , 变量 count 为 9</span><br><span class="line">变量 i 为 7 , 变量 count 为 8</span><br><span class="line">变量 i 为 8 , 变量 count 为 7</span><br><span class="line">变量 i 为 9 , 变量 count 为 6</span><br><span class="line">变量 i 为 10 , 变量 count 为 5</span><br><span class="line">变量 i 为 11 , 变量 count 为 4</span><br><span class="line">变量 i 为 12 , 变量 count 为 3</span><br><span class="line">变量 i 为 13 , 变量 count 为 2</span><br><span class="line">变量 i 为 14 , 变量 count 为 1</span><br><span class="line">变量 i 为 15 , 变量 count 为 0</span><br></pre></td></tr></table></figure>
</li>
<li><p>std standard标准的缩写，标准库函数使用的命名空间，cin 用于从控制台获取用户输入，cout 用于将数据输出到控制台。cin 是输入流对象，cout 是输出流对象，它们分别可以用 &gt;&gt; 和 &lt;&lt;，是因为分别在其类中对相应运算符进行了重载,头文件 <code>&lt;iostream&gt;</code> 在这个命名空间内声明了 <code>istream</code> 与 <code>ostream</code> 等 IO 类，同时在 std 内声明了 <code>istream cin;</code> 与 <code>ostream cout;</code> </p>
</li>
<li>静态局部变量有以下特点：<ul>
<li>该变量在全局数据区分配内存；</li>
<li>静态局部变量在程序执行到该对象的声明处时被首次初始化，即以后的函数调用不再进行初始化；</li>
<li>静态局部变量一般在声明处初始化，如果没有显式初始化，会被程序自动初始化为0；</li>
<li>它始终驻留在全局数据区，直到程序运行结束。但其作用域为局部作用域，当定义它的函数或语句块结束时，其作用域随之结束</li>
</ul>
</li>
<li><p>extern 修饰符通常用于当有两个或多个文件共享相同的全局变量或函数的时候，如下所示：</p>
<ul>
<li><p>第一个文件：main.cpp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">实例</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"> </span><br><span class="line">int count ;</span><br><span class="line">extern void write_extern();</span><br><span class="line"> </span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">   count = 5;</span><br><span class="line">   write_extern();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第二个文件：support.cpp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">实例</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"> </span><br><span class="line">extern int count;</span><br><span class="line"> </span><br><span class="line">void write_extern(void)</span><br><span class="line">&#123;</span><br><span class="line">   std::cout &lt;&lt; &quot;Count is &quot; &lt;&lt; count &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在这里，第二个文件中的 extern 关键字用于声明已经在第一个文件 main.cpp 中定义的 count。编译这两个文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ g++ main.cpp support.cpp -o write</span><br><span class="line">这会产生 write 可执行程序，尝试执行 write，它会产生下列结果：</span><br><span class="line"></span><br><span class="line">$ ./write</span><br><span class="line">Count is 5</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>thread_local 使用 thread_local 说明符声明的变量仅可在它在其上创建的线程上访问。 变量在创建线程时创建，并在销毁线程时销毁。 每个线程都有其自己的变量副本。thread_local 说明符可以与 static 或 extern 合并。可以将 thread_local 仅应用于数据声明和定义，thread_local 不能用于函数声明或定义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">thread_local int x;  // 命名空间下的全局变量</span><br><span class="line">class X</span><br><span class="line">&#123;</span><br><span class="line">    static thread_local std::string s; // 类的static成员变量</span><br><span class="line">&#125;;</span><br><span class="line">static thread_local std::string X::s;  // X::s 是需要定义的</span><br><span class="line"> </span><br><span class="line">void foo()</span><br><span class="line">&#123;</span><br><span class="line">    thread_local std::vector&lt;int&gt; v;  // 本地变量</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h4><ul>
<li>算术运算符 <code>+ - * / % ++ --</code></li>
<li>关系运算符 <code>== != &gt; &lt; &gt;= &lt;=</code></li>
<li>逻辑运算符 <code>&amp;&amp; || !</code></li>
<li>位运算符<img src="http://p4n1d4izv.bkt.clouddn.com/images/cpp-bit.png"></li>
<li>赋值运算符,先运算再赋值<img src="http://p4n1d4izv.bkt.clouddn.com/images/cpp-assign.png"></li>
<li><p>杂项运算符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sizeof 返回变量的大小</span><br><span class="line">Condition ? X : Y	条件运算符,Condition 为真 ? 则值为 X : 否则值为 Y</span><br><span class="line">， 逗号运算符，var = (count=19, incr=10, count+1); 赋值以最后一个表达式运算的结果，var=20</span><br><span class="line">. 和 -&gt;  成员运算符，引用类，结构，共用体的成员</span><br><span class="line">Cast  强制转换运算符</span><br><span class="line">&amp;   指针运算符，返回变量的地址，&amp;a 给出变量的实际地址</span><br><span class="line">*   指针运算符，指向一个变量，*var 指向变量var</span><br></pre></td></tr></table></figure>
</li>
<li><p>运算符优先级,由高到低</p>
<img src="http://p4n1d4izv.bkt.clouddn.com/images/cpp-priority.png">
<blockquote>
<p> if(i&lt;j&lt;k) 和 if(i&lt;j &amp;&amp; j&lt;k)第一个i&lt;j或者为0或者为1，只要k大于1，表达式就为true第二个必须i&lt;j且j&lt;k表达式才为true区分 if(val) 和 if(val == true)第一个只要val非零则表达式为true,val为0则表达式为false第二个只有val为1表达式为true,val非1则表达式为false</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int val = 2;</span><br><span class="line">if(val==true)&#123;              //不会进入if</span><br><span class="line">  cout&lt;&lt;&quot;val==true&quot;&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<blockquote>
<p>多个赋值操作符中，各对象必须具有相同的数据类型，或者具有可转换为同一类型的数据类型。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int ival; int *pval;</span><br><span class="line">ival = pval = 0;  //error 尽管ival和pval都可以赋值为0</span><br><span class="line">string s1,s2;</span><br><span class="line">s1 = s2 = &quot;OK&quot;    //ok</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>如果指针指向不是用new分配的内存地址，则在该指针上使用delete是不合法的<br>通常编译器不能断定一个指针是否指向动态对象，因此尽管这样做是错误的，但在大部分编译器上仍能运行通过，但是会产生运行时错误。整形提升<br>对于所有比int小的整形(char, signed char, unsigned char, short, unsigned short)，如过该类型所有可能值都包含在int中，他们会被提升为int型，否则，他们将被提升为unsigned int<br>对于包含signed和unsigned int型的表达式，表达式中的signed型整数会被转换为unsigned型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">int i = -5;</span><br><span class="line">unsigned int ii = 1;</span><br><span class="line">cout &lt;&lt; (i &gt; ii) &lt;&lt; endl; //输出1，原因是int型的i转换为unsigned int型</span><br><span class="line">short s = -5;</span><br><span class="line">unsigned short ss = 1;</span><br><span class="line">cout &lt;&lt; (s &gt; ss) &lt;&lt; endl; //输出0 比较时short和unsigned short都提升为int型</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h4><ul>
<li><code>while for do...while</code> 嵌套循环</li>
<li><code>break</code> 终止；<code>continue</code> 跳过主体剩余代码，重新开始下个条件；<code>goto</code> 跳转到被标记的语句，不建议使用</li>
<li>无限循环,表达式留空，假设为真<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for( ; ; )</span><br><span class="line">&#123;</span><br><span class="line">  printf(&quot;This loop will run forever.\n&quot;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="判断"><a href="#判断" class="headerlink" title="判断"></a>判断</h4><ul>
<li><code>if  if...else  嵌套if  switch  嵌套switch</code></li>
<li><code>?:</code> 条件运算符<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;ctime&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int max(int, int);</span><br><span class="line"></span><br><span class="line">void fun_swap_value(int, int);</span><br><span class="line"></span><br><span class="line">void fun_swap_point(int *, int *);</span><br><span class="line"></span><br><span class="line">void fun_swap_cite(int, int);</span><br><span class="line"></span><br><span class="line">void fun_pptr();</span><br><span class="line"></span><br><span class="line">void ptrArray();</span><br><span class="line"></span><br><span class="line">void ptrCompare();</span><br><span class="line"></span><br><span class="line">void getSeconds(unsigned long *par);</span><br><span class="line"></span><br><span class="line">void getAvg(int *ptr, int size);</span><br><span class="line"></span><br><span class="line">int *getRandom();</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    int a = 100;//实际整型变量</span><br><span class="line">    int b = 200;</span><br><span class="line">    char var1[10];</span><br><span class="line">    //变量的地址</span><br><span class="line">    cout &lt;&lt; &quot;a address &quot; &lt;&lt; &amp;a &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;var1 address &quot; &lt;&lt; &amp;var1 &lt;&lt; endl;</span><br><span class="line">    //指针是一个变量，值为变量的地址,下面不同类型的指针的值</span><br><span class="line">    //都是代表内存地址的十六进制数，指针所指向的变量类型不同</span><br><span class="line">    int *ip = &amp;a;//定义整型指针，并赋值变量的地址</span><br><span class="line">    //输出在指针变量中存储的地址</span><br><span class="line">    cout &lt;&lt; &quot;ip address &quot; &lt;&lt; ip &lt;&lt; endl;</span><br><span class="line">    //访问指针中地址的变量值</span><br><span class="line">    cout &lt;&lt; &quot;*ip value &quot; &lt;&lt; *ip &lt;&lt; endl;</span><br><span class="line">    double *dp;//double型的指针</span><br><span class="line">    float *fp;//float型的指针</span><br><span class="line">    char *cp;//char型的指针</span><br><span class="line"></span><br><span class="line">    //为指针变量赋一个 NULL 值是一个良好的编程习惯</span><br><span class="line">    //赋为 NULL 值的指针被称为空指针</span><br><span class="line">    //NULL 指针是一个定义在标准库中的值为零的常量</span><br><span class="line">    //该指针不指向一个可访问的内存位置</span><br><span class="line">    int *ptr0 = NULL;</span><br><span class="line">    cout &lt;&lt; &quot;ptr value is &quot; &lt;&lt; ptr0 &lt;&lt; endl;</span><br><span class="line">    if (!ptr0) cout &lt;&lt; &quot;ptr is NULL&quot; &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    int var[3] = &#123;10, 100, 200&#125;;</span><br><span class="line">    int *ptr;</span><br><span class="line">    ptr = var;</span><br><span class="line">    //指针中第一个元素的地址，这里不使用&amp;var，指针类型不一致，但是与&amp;var[0]相同</span><br><span class="line">    //因为ptr指向的是int *var[0]的地址,而不是int[3] *var</span><br><span class="line">    //ptr = &amp;var[0];//也可以使用这种方式</span><br><span class="line">    cout &lt;&lt; &quot;*int[3] &amp;var address &quot; &lt;&lt; &amp;var &lt;&lt; endl;</span><br><span class="line">    for (int i = 0; i &lt; 3; ++i) &#123;</span><br><span class="line">        cout &lt;&lt; &quot;index &quot; &lt;&lt; i &lt;&lt; &quot; address is &quot; &lt;&lt; ptr &lt;&lt; &quot; value is &quot; &lt;&lt; *ptr &lt;&lt; endl;</span><br><span class="line">        //移动到下一个位置</span><br><span class="line">        ptr++;</span><br><span class="line">        //index 0 address is 0x61feec value is 10</span><br><span class="line">        //index 1 address is 0x61fef0 value is 100</span><br><span class="line">        //index 2 address is 0x61fef4 value is 200</span><br><span class="line">        //如果这里指针指向的变量是整型数据 1000，占4个字节，移动到下个整数，当前位置往后移4个字节,地址是1004</span><br><span class="line">        //相应的如果这个变量是字符数据，占1个字节，移动到下个字符，当前位置往后移1个字节,地址是1001</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //var++;不正确,是数组第一个元素的常量，不能作为左值</span><br><span class="line">    //var[2]=500;</span><br><span class="line">    *(var + 2) = 500;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;---------&quot; &lt;&lt; endl;</span><br><span class="line">    ptrCompare();</span><br><span class="line">    cout &lt;&lt; &quot;---------&quot; &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    //指针数组，包含指针的数组</span><br><span class="line">    ptrArray();</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;---------&quot; &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    //二级指针，指向指针的指针，多级间接寻址</span><br><span class="line">    fun_pptr();</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;---------&quot; &lt;&lt; endl;</span><br><span class="line">    int ret = max(a, b);</span><br><span class="line">    cout &lt;&lt; &quot;max :&quot; &lt;&lt; ret &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;a=&quot; &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;b=&quot; &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">    fun_swap_value(a, b);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /** 调用函数来交换值</span><br><span class="line">    * &amp;a 表示指向 a 的指针，即变量 a 的地址</span><br><span class="line">    * &amp;b 表示指向 b 的指针，即变量 b 的地址</span><br><span class="line">    */</span><br><span class="line">    fun_swap_point(&amp;a, &amp;b);</span><br><span class="line">    cout &lt;&lt; &quot;---------&quot; &lt;&lt; endl;</span><br><span class="line">    /**传递指针给函数，声明函数参数为指针类型*/</span><br><span class="line">    unsigned long sec;</span><br><span class="line">    getSeconds(&amp;sec);</span><br><span class="line">    // 输出实际值</span><br><span class="line">    cout &lt;&lt; &quot;Number of seconds :&quot; &lt;&lt; sec &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;---------&quot; &lt;&lt; endl;</span><br><span class="line">    int balance[5] = &#123;1000, 2000, 3000, 4000, 6000&#125;;</span><br><span class="line">    getAvg(balance, 5);</span><br><span class="line">    cout &lt;&lt; &quot;---------&quot; &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    int *random = getRandom();</span><br><span class="line">    for (int j = 0; j &lt; 10; ++j) &#123;</span><br><span class="line">        cout &lt;&lt; &quot;*(random + &quot; &lt;&lt; j &lt;&lt; &quot;) : &quot;;</span><br><span class="line">        cout &lt;&lt; *(random + j) &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;---------&quot; &lt;&lt; endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void ptrCompare() &#123;</span><br><span class="line">    int var[3] = &#123;10, 100, 200&#125;;</span><br><span class="line">    int *ptr;</span><br><span class="line">    ptr = var;</span><br><span class="line">    int i = 0;</span><br><span class="line">    while (ptr &lt;= &amp;var[2]) &#123;</span><br><span class="line">        cout &lt;&lt; &quot;index &quot; &lt;&lt; i &lt;&lt; &quot; address is &quot; &lt;&lt; ptr &lt;&lt; &quot; value is &quot; &lt;&lt; *ptr &lt;&lt; endl;</span><br><span class="line">        //指向下一个位置</span><br><span class="line">        ptr++;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void ptrArray() &#123;</span><br><span class="line">    int var[3] = &#123;10, 100, 200&#125;;</span><br><span class="line">    int *ptrAry[3];</span><br><span class="line">    for (int j = 0; j &lt; 3; ++j) &#123;</span><br><span class="line">        ptrAry[j] = &amp;var[j];</span><br><span class="line">    &#125;</span><br><span class="line">    for (int k = 0; k &lt; 3; ++k) &#123;</span><br><span class="line">        cout &lt;&lt; &quot;Value of ptrAry[&quot; &lt;&lt; k &lt;&lt; &quot;] = &quot;;</span><br><span class="line">        cout &lt;&lt; *ptrAry[k] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const char *names[4] = &#123;</span><br><span class="line">            &quot;Zara Ali&quot;,</span><br><span class="line">            &quot;Hina Ali&quot;,</span><br><span class="line">            &quot;Nuha Ali&quot;,</span><br><span class="line">            &quot;Sara Ali&quot;,</span><br><span class="line">    &#125;;</span><br><span class="line">    for (int m = 0; m &lt; 4; m++) &#123;</span><br><span class="line">        cout &lt;&lt; &quot;Value of names[&quot; &lt;&lt; m &lt;&lt; &quot;] = &quot;;</span><br><span class="line">        cout &lt;&lt; names[m] &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; &amp;names[m] &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; *names[m] &lt;&lt; endl;//指向的是字符串的第一个字符</span><br><span class="line">        cout &lt;&lt; *names[m] + 1 &lt;&lt; endl;//第一个字符+1 转换ASCII值</span><br><span class="line">        cout &lt;&lt; *(names[m] + 1) &lt;&lt; endl;//指向的是字符串的第二个字符</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**多级间接寻址*/</span><br><span class="line">void fun_pptr() &#123;</span><br><span class="line">    int var;</span><br><span class="line">    int *ptr;</span><br><span class="line">    int **pptr;</span><br><span class="line"></span><br><span class="line">    var = 3000;</span><br><span class="line"></span><br><span class="line">    ptr = &amp;var;</span><br><span class="line">    pptr = &amp;ptr;</span><br><span class="line">    cout &lt;&lt; &quot;Value of var :&quot; &lt;&lt; var &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;Value available at *ptr :&quot; &lt;&lt; *ptr &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;Value available at **pptr :&quot; &lt;&lt; **pptr &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void getSeconds(unsigned long *par) &#123;</span><br><span class="line">    *par = time(NULL);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void getAvg(int *ptr, int size) &#123;</span><br><span class="line">    int sum = 0;</span><br><span class="line">    for (int i = 0; i &lt; size; ++i) &#123;</span><br><span class="line">        sum += ptr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    double avg = double(sum) / size;</span><br><span class="line">    cout &lt;&lt; &quot;avg is &quot; &lt;&lt; avg &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**函数返回指针*/</span><br><span class="line">int *getRandom() &#123;</span><br><span class="line">    static int r[10];</span><br><span class="line">    //设置种子</span><br><span class="line">    srand((unsigned) time(NULL));</span><br><span class="line">    for (int i = 0; i &lt; 10; ++i) &#123;</span><br><span class="line">        r[i] = rand();</span><br><span class="line">        cout &lt;&lt; r[i] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    return r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int max(int a, int b) &#123;</span><br><span class="line">    return a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 传值调用</span><br><span class="line"> * 实际参数的参数值传值给形式参数，调用不会影响实际参数*/</span><br><span class="line">void fun_swap_value(int a, int b) &#123;</span><br><span class="line">    int temp = a;</span><br><span class="line">    a = b;</span><br><span class="line">    b = temp;</span><br><span class="line">    cout &lt;&lt; &quot;fun_swap_value a=&quot; &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;fun_swap_value b=&quot; &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**指针调用</span><br><span class="line"> * 实际参数的地址传给形式参数，修改形式参数会影响实际参数</span><br><span class="line"> */</span><br><span class="line">void fun_swap_point(int *a, int *b) &#123;</span><br><span class="line">    int temp;</span><br><span class="line">    temp = *a; // 保存地址 x 的值</span><br><span class="line">    *a = *b; //把 y 赋值给 x</span><br><span class="line">    *b = temp; //把 x 赋值给 y</span><br><span class="line">    cout &lt;&lt; &quot;fun_swap_point a=&quot; &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;fun_swap_point b=&quot; &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void fun_swap_cite(int) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="http://www.runoob.com/cplusplus/cpp-tutorial.html" target="_blank" rel="noopener">菜鸟教程</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/04/08/SQLite-三/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/08/SQLite-三/" itemprop="url">SQLite(三)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-08T00:07:00+08:00">
                2018-04-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/08/SQLite-三/" class="leancloud_visitors" data-flag-title="SQLite(三)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="SQLite-Java"><a href="#SQLite-Java" class="headerlink" title="SQLite Java"></a>SQLite Java</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/04/07/Source-Insight-使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/07/Source-Insight-使用/" itemprop="url">Source Insight 使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-07T21:36:00+08:00">
                2018-04-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tools/" itemprop="url" rel="index">
                    <span itemprop="name">Tools</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/07/Source-Insight-使用/" class="leancloud_visitors" data-flag-title="Source Insight 使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <ul>
<li>New project<img src="http://p4n1d4izv.bkt.clouddn.com/images/srcinsight-1.png"></li>
<li>Add all<img src="http://p4n1d4izv.bkt.clouddn.com/images/srcinsight-2.png">
<img src="http://p4n1d4izv.bkt.clouddn.com/images/srcinsight-3.png"></li>
<li>close<img src="http://p4n1d4izv.bkt.clouddn.com/images/srcinsight-4.png">
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/04/07/Source-Insight-使用/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/04/02/Java-小知识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/02/Java-小知识/" itemprop="url">Java 小知识</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-02T23:53:00+08:00">
                2018-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/02/Java-小知识/" class="leancloud_visitors" data-flag-title="Java 小知识">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p><code>transient</code> vs <code>volatile</code>不同之处</p>
<ul>
<li><p><code>volatile</code>和序列化无关，写数据到改修饰的变量，会同步刷新到内存中，访问变量时从内存中读取，与 <code>synchronized</code> 块相比，<code>volatile</code> 变量所需的编码较少，并且运行时开销也较少，但是它所能实现的功能也仅是 <code>synchronized</code> 的一部分,不具备原子性。只能在有限的一些情形下使用 volatile 变量替代锁。要使 volatile 变量提供理想的线程安全，必须同时满足下面两个条件：<br>1.对变量的写操作不依赖于当前值<br>2.该变量没有包含在具有其他变量的不变式中</p>
</li>
<li><p>第一个条件的限制使 volatile 变量不能用作线程安全计数器。虽然增量操作（x++）看上去类似一个单独操作，实际上它是一个由读取－修改－写入操作序列组成的组合操作，必须以原子方式执行，而 volatile 不能提供必须的原子特性</p>
</li>
</ul>
</li>
<li><p>如果凑巧两个线程在同一时间使用不一致的值执行 setLower 和 setUpper 的话，则会使范围处于不一致的状态。例如，如果初始状态是 (0, 5)，同一时间内，线程 A 调用 setLower(4) 并且线程 B 调用 setUpper(3)，显然这两个操作交叉存入的值是不符合条件的，那么两个线程都会通过用于保护不变式的检查，使得最后的范围值是 (4, 3) —— 一个无效值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@NotThreadSafe </span><br><span class="line">public class NumberRange &#123;</span><br><span class="line">    private int lower, upper;</span><br><span class="line"> </span><br><span class="line">    public int getLower() &#123; return lower; &#125;</span><br><span class="line">    public int getUpper() &#123; return upper; &#125;</span><br><span class="line"> </span><br><span class="line">    public void setLower(int value) &#123; </span><br><span class="line">        if (value &gt; upper) </span><br><span class="line">            throw new IllegalArgumentException(...);</span><br><span class="line">        lower = value;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public void setUpper(int value) &#123; </span><br><span class="line">        if (value &lt; lower) </span><br><span class="line">            throw new IllegalArgumentException(...);</span><br><span class="line">        upper = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>正确使用volatile模式</p>
<ul>
<li><p>状态标志,公共特性是：通常只有一种状态转换；shutdownRequested 标志从 false 转换为 true，然后程序停止</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> volatile boolean shutdownRequested;</span><br><span class="line">...</span><br><span class="line">public void shutdown() &#123; shutdownRequested = true; &#125;</span><br><span class="line"> </span><br><span class="line">public void doWork() &#123; </span><br><span class="line">    while (!shutdownRequested) &#123; </span><br><span class="line">        // do stuff</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><a href="https://www.ibm.com/developerworks/cn/java/j-jtp06197.html" target="_blank" rel="noopener">其他待续</a></p>
</li>
</ul>
</li>
<li><p>序列化会排除被<code>transient</code>修饰的变量，反序列化会返回相应的默认值</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/04/02/Window和WindowManager/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/02/Window和WindowManager/" itemprop="url">Window和WindowManager</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-02T23:17:00+08:00">
                2018-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/02/Window和WindowManager/" class="leancloud_visitors" data-flag-title="Window和WindowManager">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p>Window和WindowManager<br>Window表示一个窗口，可以实现在桌面上显示悬浮窗，Window是一个抽象类，具体实现是PhoneWindow。通过WindowManager创建Window，WindowManager是外界访问Window的入口，Window的具体实现位于WindowManagerService，WindowManager和WindowManagerService交互是一个IPC过程，Window实际是View的直接管理者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;/&gt;</span><br><span class="line"> </span><br><span class="line">val btn = Button(baseContext)</span><br><span class="line">        btn.text = &quot;button&quot;</span><br><span class="line">        btn.setOnClickListener &#123; toast(&quot;Window Demo&quot;) &#125;</span><br><span class="line">        val layoutParams = LayoutParams(LayoutParams.WRAP_CONTENT,</span><br><span class="line">                LayoutParams.WRAP_CONTENT, 0, 0, PixelFormat.TRANSLUCENT)</span><br><span class="line">        layoutParams.type = LayoutParams.TYPE_SYSTEM_OVERLAY/TYPE_SYSTEM_ERROR/TYPE_SYSTEM_OVERLAY/TYPE_APPLICATION_PANEL</span><br><span class="line">        //不需要获取焦点，不需要接收各种输入事件</span><br><span class="line">        layoutParams.flags = LayoutParams.FLAG_NOT_FOCUSABLE</span><br><span class="line">                //window 区域以为的单击事件传递给底层window，当前window区域以内的自己处理，否则其他window无法收到单击事件</span><br><span class="line">                .or(LayoutParams.FLAG_NOT_TOUCH_MODAL)</span><br><span class="line">                //window 显示在锁屏上</span><br><span class="line">                .or(LayoutParams.FLAG_SHOW_WHEN_LOCKED)</span><br><span class="line">        layoutParams.gravity = Gravity.LEFT.or(Gravity.TOP)</span><br><span class="line">        layoutParams.x = 100</span><br><span class="line">        layoutParams.y = 300</span><br><span class="line">        windowManager.addView(btn, layoutParams)</span><br></pre></td></tr></table></figure>
</li>
<li><p>public interface WindowManager extends ViewManager</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public interface ViewManager</span><br><span class="line">&#123;</span><br><span class="line">    /**</span><br><span class="line">     * Assign the passed LayoutParams to the passed View and add the view to the window.</span><br><span class="line">     * &lt;p&gt;Throws &#123;@link android.view.WindowManager.BadTokenException&#125; for certain programming</span><br><span class="line">     * errors, such as adding a second view to a window without removing the first view.</span><br><span class="line">     * &lt;p&gt;Throws &#123;@link android.view.WindowManager.InvalidDisplayException&#125; if the window is on a</span><br><span class="line">     * secondary &#123;@link Display&#125; and the specified display can&apos;t be found</span><br><span class="line">     * (see &#123;@link android.app.Presentation&#125;).</span><br><span class="line">     * @param view The view to be added to this window.</span><br><span class="line">     * @param params The LayoutParams to assign to view.</span><br><span class="line">     */</span><br><span class="line">    public void addView(View view, ViewGroup.LayoutParams params);</span><br><span class="line">    public void updateViewLayout(View view, ViewGroup.LayoutParams params);</span><br><span class="line">    public void removeView(View view);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加触摸事件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">val btn = Button(baseContext)</span><br><span class="line">        btn.isClickable = true</span><br><span class="line">        btn.text = &quot;button&quot;</span><br><span class="line"></span><br><span class="line">//        btn.setOnClickListener &#123; toast(&quot;Window Demo&quot;) &#125;</span><br><span class="line">        val layoutParams = LayoutParams(LayoutParams.WRAP_CONTENT,</span><br><span class="line">                LayoutParams.WRAP_CONTENT, 0, 0, PixelFormat.TRANSLUCENT)</span><br><span class="line">//        layoutParams.type = LayoutParams.TYPE_SYSTEM_OVERLAY</span><br><span class="line">        layoutParams.type =LayoutParams.TYPE_APPLICATION_PANEL</span><br><span class="line">        layoutParams.flags =</span><br><span class="line">                //不需要获取焦点，不需要接收各种输入事件</span><br><span class="line">                LayoutParams.FLAG_NOT_FOCUSABLE</span><br><span class="line">                        //window 区域以为的单击事件传递给底层window，当前window区域以内的自己处理，否则其他window无法收到单击事件</span><br><span class="line">                        .or(LayoutParams.FLAG_NOT_TOUCH_MODAL)</span><br><span class="line">                        //window 显示在锁屏上</span><br><span class="line">                        .or(LayoutParams.FLAG_SHOW_WHEN_LOCKED)</span><br><span class="line">        layoutParams.gravity = Gravity.LEFT.or(Gravity.TOP)</span><br><span class="line">        layoutParams.x = 100</span><br><span class="line">        layoutParams.y = 300</span><br><span class="line">        btn.setOnTouchListener &#123; v, event -&gt;</span><br><span class="line">            when (event.action) &#123;</span><br><span class="line">                MotionEvent.ACTION_MOVE -&gt; &#123;</span><br><span class="line">                    layoutParams.x = event.rawX.toInt()</span><br><span class="line">                    layoutParams.y = event.rawY.toInt()</span><br><span class="line">                    windowManager.updateViewLayout(btn, layoutParams)</span><br><span class="line">                &#125;</span><br><span class="line">                else -&gt; &#123;</span><br><span class="line">                    Log.i(&quot;touch&quot;, &quot;else&quot;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return@setOnTouchListener false</span><br><span class="line">        &#125;</span><br><span class="line">        windowManager.addView(btn, layoutParams)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Window内部机制"><a href="#Window内部机制" class="headerlink" title="Window内部机制"></a>Window内部机制</h4><p>Window是抽象概念，每一个Window对应一个View和ViewRootImpl，以View的形式存在</p>
<ul>
<li>接口<code>WindowManager</code>实现类<code>WindowManagerImpl</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void addView(@NonNull View view, @NonNull ViewGroup.LayoutParams params) &#123;</span><br><span class="line">       applyDefaultToken(params);</span><br><span class="line">       mGlobal.addView(view, params, mContext.getDisplay(), mParentWindow);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void updateViewLayout(@NonNull View view, @NonNull ViewGroup.LayoutParams params) &#123;</span><br><span class="line">       applyDefaultToken(params);</span><br><span class="line">       mGlobal.updateViewLayout(view, params);</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line">@Override</span><br><span class="line">public void removeView(View view) &#123;</span><br><span class="line">       mGlobal.removeView(view, false);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/04/02/SQLite-二/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/02/SQLite-二/" itemprop="url">SQLite(二)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-02T12:08:00+08:00">
                2018-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/02/SQLite-二/" class="leancloud_visitors" data-flag-title="SQLite(二)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h4><ul>
<li><p>创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlite3 DatabaseName.db</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看数据库列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.databases</span><br></pre></td></tr></table></figure>
</li>
</ul>
<img src="http://p4n1d4izv.bkt.clouddn.com/images/sqlite3-db.png">
<ul>
<li><p>导出完整的数据库到一个文本文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlite3 DatabaseName.db .dump &gt; DatabaseName.sql</span><br><span class="line"></span><br><span class="line">恢复数据库</span><br><span class="line">sqlite3 DatabaseName.db &lt; DatabaseName.sql</span><br></pre></td></tr></table></figure>
</li>
<li><p>SQLite 的 ATTACH DATABASE 语句是用来选择一个特定的数据库，使用该命令后，所有的 SQLite 语句将在附加的数据库下执行</p>
<blockquote>
<p>如果数据库尚未被创建，将创建一个数据库，如果数据库已存在，则把数据库文件名称与逻辑数据库 ‘Alias-Name’ 绑定在一起</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ATTACH DATABASE &apos;DatabaseName&apos; As &apos;Alias-Name&apos;;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>DETACH DTABASE 分离数据库，上述附件数据库的反操作，DETACH 命令将只断开给定名称的连接，而其余的仍然有效，无法分离 main 或 temp 数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DETACH DATABASE &apos;Alias-Name&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建表  <code>CREATE TABLE</code>创建表 <code>.tables</code> 命令来验证表是否已成功创建  <code>.schema</code>命令得到表的完整信息</p>
<img src="http://p4n1d4izv.bkt.clouddn.com/images/createtable.png"></li>
<li>删除表 <code>DROP TABLE database_name.table_name;</code></li>
<li><p>INSERT 添加新的记录，新的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO TABLE_NAME [(column1, column2, column3,...columnN)]  </span><br><span class="line">VALUES (value1, value2, value3,...valueN);</span><br><span class="line"></span><br><span class="line">省略列名，保证顺序一致</span><br><span class="line">INSERT INTO TABLE_NAME VALUES (value1,value2,value3,...valueN);</span><br><span class="line"></span><br><span class="line">INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY)</span><br><span class="line">VALUES (6, &apos;Kim&apos;, 22, &apos;South-Hall&apos;, 45000.00 );</span><br></pre></td></tr></table></figure>
</li>
<li><p>将第二个表数据添加到第一个表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO first_table_name [(column1, column2, ... columnN)] </span><br><span class="line">   SELECT column1, column2, ...columnN </span><br><span class="line">   FROM second_table_name</span><br><span class="line">   [WHERE condition];</span><br></pre></td></tr></table></figure>
</li>
<li><p>SELECT 获取表中数据，返回结果集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT column1, column2, columnN FROM table_name;</span><br><span class="line"></span><br><span class="line">SELECT * FROM table_name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.header on</span><br><span class="line">.mode column</span><br><span class="line">.width 10, 20, 10</span><br></pre></td></tr></table></figure>
</li>
</ul>
<img src="http://p4n1d4izv.bkt.clouddn.com/images/selectfrom.png">
<ul>
<li>Schema 信息<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">列出所有在数据库中创建的表</span><br><span class="line">SELECT tbl_name FROM sqlite_master WHERE type = &apos;table&apos;;</span><br><span class="line">产生以下结果：</span><br><span class="line"></span><br><span class="line">tbl_name</span><br><span class="line">----------</span><br><span class="line">COMPANY</span><br><span class="line"></span><br><span class="line">列出关于 COMPANY 表的完整信息</span><br><span class="line">SELECT sql FROM sqlite_master WHERE type = &apos;table&apos; AND tbl_name = &apos;COMPANY&apos;;</span><br><span class="line">假设在 testDB.db 中已经存在唯一的 COMPANY 表，产生以下结果：</span><br><span class="line"></span><br><span class="line">CREATE TABLE COMPANY(</span><br><span class="line">   ID INT PRIMARY KEY     NOT NULL,</span><br><span class="line">   NAME           TEXT    NOT NULL,</span><br><span class="line">   AGE            INT     NOT NULL,</span><br><span class="line">   ADDRESS        CHAR(50),</span><br><span class="line">   SALARY         REAL</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h4><ul>
<li><p>算术运算符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select 10+20;</span><br><span class="line">30</span><br><span class="line">sqlite&gt; .mode line</span><br><span class="line">sqlite&gt; select 10-20;</span><br><span class="line">10-20 = -10</span><br><span class="line">sqlite&gt; select 1/3;</span><br><span class="line">  1/3 = 0</span><br><span class="line">sqlite&gt; select 12%5;</span><br><span class="line"> 12%5 = 2</span><br></pre></td></tr></table></figure>
</li>
<li><p>比较运算符</p>
<img src="http://p4n1d4izv.bkt.clouddn.com/images/sqlite-compare.png"></li>
<li><p>逻辑运算符</p>
<img src="http://p4n1d4izv.bkt.clouddn.com/images/sqlite-logic.png">
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">WHERE AGE &gt;= 25 AND/OR SALARY &gt;= 65000;</span><br><span class="line">WHERE AGE IS NOT NULL</span><br><span class="line">WHERE NAME LIKE &apos;Ki%&apos;;</span><br><span class="line">WHERE NAME GLOB &apos;Ki*&apos;;</span><br><span class="line">WHERE AGE NOT IN ( 25, 27 );</span><br><span class="line">WHERE AGE BETWEEN 25 AND 27;</span><br><span class="line"></span><br><span class="line">SQL 子查询，子查询查找 SALARY &gt; 65000 的带有 AGE 字段的所有记录，后边的 WHERE 子句与 EXISTS 运算符一起使用</span><br><span class="line"> SELECT AGE FROM COMPANY WHERE EXISTS (SELECT AGE FROM COMPANY WHERE SALARY &gt; 65000);</span><br><span class="line"></span><br><span class="line">AGE</span><br><span class="line">----------</span><br><span class="line">25</span><br><span class="line">23</span><br><span class="line">25</span><br><span class="line"></span><br><span class="line">SELECT * FROM COMPANY WHERE AGE &gt; (SELECT AGE FROM COMPANY WHERE SALARY &gt; 65000);</span><br></pre></td></tr></table></figure>
</li>
<li><p>位运算符  A=60， B=13</p>
<img src="http://p4n1d4izv.bkt.clouddn.com/images/sqlite-bit.png">
</li>
</ul>
<h4 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h4><ul>
<li><p>布尔表达式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM COMPANY WHERE SALARY = 10000;</span><br></pre></td></tr></table></figure>
</li>
<li><p>数值表达式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*) AS &quot;RECORDS&quot; FROM COMPANY; </span><br><span class="line">RECORDS = 7</span><br></pre></td></tr></table></figure>
</li>
<li><p>日期表达式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select CURRENT_TIMESTAMP;</span><br><span class="line">CURRENT_TIMESTAMP</span><br><span class="line">-------------------</span><br><span class="line">2018-04-07 15:36:11</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Where子句"><a href="#Where子句" class="headerlink" title="Where子句"></a>Where子句</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM COMPANY WHERE AGE BETWEEN 25 AND 27;</span><br><span class="line"></span><br><span class="line">SELECT AGE FROM COMPANY </span><br><span class="line">        WHERE EXISTS (SELECT AGE FROM COMPANY WHERE SALARY &gt; 65000);</span><br><span class="line">        </span><br><span class="line">SELECT * FROM COMPANY </span><br><span class="line">        WHERE AGE &gt; (SELECT AGE FROM COMPANY WHERE SALARY &gt; 65000);</span><br></pre></td></tr></table></figure>
<h4 id="AND-OR"><a href="#AND-OR" class="headerlink" title="AND/OR"></a>AND/OR</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM COMPANY WHERE AGE &gt;= 25 AND SALARY &gt;= 65000;</span><br><span class="line"></span><br><span class="line">SELECT * FROM COMPANY WHERE AGE &gt;= 25 OR SALARY &gt;= 65000;</span><br></pre></td></tr></table></figure>
<h4 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE COMPANY SET ADDRESS = &apos;Texas&apos; WHERE ID = 6;</span><br><span class="line"></span><br><span class="line">UPDATE COMPANY SET ADDRESS = &apos;Texas&apos;, SALARY = 20000.00;</span><br></pre></td></tr></table></figure>
<h4 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM COMPANY WHERE ID = 7;</span><br><span class="line">DELETE FROM COMPANY;</span><br></pre></td></tr></table></figure>
<h4 id="Like"><a href="#Like" class="headerlink" title="Like"></a>Like</h4><blockquote>
<p>通配符 百分号（%）代表零个、一个或多个数字或字符。下划线（_）代表一个单一的数字或字符</p>
</blockquote>
<img src="http://p4n1d4izv.bkt.clouddn.com/images/sqlite3-like.png">
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AGE 以 2 开头的所有记录</span><br><span class="line">SELECT * FROM COMPANY WHERE AGE  LIKE &apos;2%&apos;;</span><br><span class="line"></span><br><span class="line">ADDRESS 文本里包含一个连字符（-）的所有记录</span><br><span class="line">SELECT * FROM COMPANY WHERE ADDRESS  LIKE &apos;%-%&apos;;</span><br></pre></td></tr></table></figure>
<h4 id="Glob"><a href="#Glob" class="headerlink" title="Glob"></a>Glob</h4><blockquote>
<p>星号（*）代表零个、一个或多个数字或字符。问号（?）代表一个单一的数字或字符,大小写敏感</p>
</blockquote>
<img src="http://p4n1d4izv.bkt.clouddn.com/images/sqlite3-glob.png">
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM COMPANY WHERE AGE  GLOB &apos;2*&apos;;</span><br></pre></td></tr></table></figure>
<h4 id="Limit"><a href="#Limit" class="headerlink" title="Limit"></a>Limit</h4><ul>
<li><p>限制返回数据数量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM COMPANY LIMIT 6;</span><br></pre></td></tr></table></figure>
</li>
<li><p>特定的偏移开始提取记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM COMPANY LIMIT 3 OFFSET 2;</span><br><span class="line"></span><br><span class="line">ID          NAME        AGE         ADDRESS     SALARY</span><br><span class="line">----------   ----------   ----------      ----------    ----------</span><br><span class="line">3           Teddy       23          Norway      20000.0</span><br><span class="line">4           Mark        25          Rich-Mond   65000.0</span><br><span class="line">5           David       27          Texas       85000.0</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Order-By"><a href="#Order-By" class="headerlink" title="Order By"></a>Order By</h4><ul>
<li>按 NAME 和 SALARY 升序降序排序<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM COMPANY ORDER BY NAME, SALARY [ASC|DESC];</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Group-By"><a href="#Group-By" class="headerlink" title="Group By"></a>Group By</h4><ul>
<li>对相同的数据进行分组,在 SELECT 语句中，GROUP BY 子句放在 WHERE 子句之后，放在 ORDER BY 子句之前<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">查找名称，薪资总和数据，以名称分组</span><br><span class="line">SELECT NAME, SUM(SALARY) FROM COMPANY GROUP BY NAME;</span><br><span class="line">SELECT NAME, SUM(SALARY) FROM COMPANY GROUP BY NAME ORDER BY NAME;</span><br><span class="line"></span><br><span class="line">NAME        SUM(SALARY)</span><br><span class="line">----------  -----------</span><br><span class="line">Allen       15000.0</span><br><span class="line">David       85000.0</span><br><span class="line">James       10000.0</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Having"><a href="#Having" class="headerlink" title="Having"></a>Having</h4><ul>
<li>过滤分组数据<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT column1, column2</span><br><span class="line">FROM table1, table2</span><br><span class="line">WHERE [ conditions ]</span><br><span class="line">GROUP BY column1, column2</span><br><span class="line">HAVING [ conditions ]</span><br><span class="line">ORDER BY column1, column2</span><br><span class="line"></span><br><span class="line">名称出现2次的数据</span><br><span class="line">SELECT * FROM COMPANY GROUP BY name HAVING count(name) &gt; 2;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Distinct"><a href="#Distinct" class="headerlink" title="Distinct"></a>Distinct</h4><ul>
<li>获取重复记录中的唯一一次记录<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT column1, column2,.....columnN </span><br><span class="line">FROM table_name</span><br><span class="line">WHERE [condition]</span><br><span class="line"></span><br><span class="line">去掉重复名称</span><br><span class="line">SELECT DISTINCT name FROM COMPANY;</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/03/30/SQLite-一/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/30/SQLite-一/" itemprop="url">SQLite(一)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-30T15:56:00+08:00">
                2018-03-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/30/SQLite-一/" class="leancloud_visitors" data-flag-title="SQLite(一)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>SQLite特点：无服务器、零配置、事务性的 SQL 数据库引擎，SQLite 引擎不是一个独立的进程，可以按应用程序需求进行静态或动态连接；非常小轻量级，兼容ACID原则，是进程或线程安全的</p>
<blockquote>
<p>ACID是一组强调高可靠性的数据库系统设计原则，在软件崩溃甚至是硬件故障的情况下，数据也不会损坏。当你需要依赖兼容ACID原则的业务时，你不必重复造轮子去实现一致性检查和崩溃恢复机制。如果你有额外的安全保证机制，可以调整牺牲掉ACID的一些可靠性换取更高的性能和数据吞吐量<br>A: atomicity (原子性)<br>C: consistency (一致性)<br>I: isolation （隔离性）<br>D: durability （持久性）</p>
</blockquote>
<blockquote>
<p>SQL92 不支持的特性如下<br>RIGHT OUTER JOIN    只实现了 LEFT OUTER JOIN<br>FULL OUTER JOIN       只实现了 LEFT OUTER JOIN<br>ALTER TABLE          支持 RENAME TABLE 和 ALTER TABLE 的 ADD COLUMN variants 命令，不支持 DROP COLUMN、ALTER COLUMN、ADD CONSTRAINT<br>Trigger         支持 FOR EACH ROW 触发器，但不支持 FOR EACH STATEMENT 触发器<br>VIEWs          在 SQLite 中，视图是只读的,不可以在视图上执行 DELETE、INSERT 或 UPDATE 语句<br>GRANT 和 REVOKE    可以应用的唯一的访问权限是底层操作系统的正常文件访问权限</p>
</blockquote>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/03/30/SQLite-一/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/03/25/Kotlin-for-Android-七/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/25/Kotlin-for-Android-七/" itemprop="url">Kotlin for Android(七)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-25T12:08:00+08:00">
                2018-03-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kotlin/" itemprop="url" rel="index">
                    <span itemprop="name">Kotlin</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/25/Kotlin-for-Android-七/" class="leancloud_visitors" data-flag-title="Kotlin for Android(七)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h4 id="创建业务逻辑访问数据"><a href="#创建业务逻辑访问数据" class="headerlink" title="创建业务逻辑访问数据"></a>创建业务逻辑访问数据</h4><blockquote>
<p>从数据库获取数据<br>检查是否存在对应星期的数据<br>如果有，返回UI并且渲染<br>如果没有，请求服务器获取数据<br>结果被保存在数据库中并且返回UI渲染</p>
</blockquote>
<ul>
<li><p>数据源应该是一个具体的实现，这样就可以被容易地修改，所以增加一些额外的代码，然后把 command 从数据访问中抽象出来听</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface ForecastDataSource &#123;</span><br><span class="line">fun requestForecastByZipCode(zipCode: Long, date: Long): For</span><br><span class="line">ecastList?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用数据库的数据源和服务端数据源。顺序是很重要的，因为它会根据顺序去遍历这个sources，然后一旦获取到有效的返回值就会停止查询。逻辑顺序是先在本地查询（本地数据库中），然后再通过API查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class ForecastProvider(private val source: List&lt;ForecastDataSource&gt; = ForecastProvider.SOURCES) &#123;</span><br><span class="line">    companion object &#123;</span><br><span class="line">        val DAY_IN_MILLIS = 1000 * 60 * 60 * 24</span><br><span class="line">        val SOURCES = listOf(ForecastDb(), ForecastServer())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fun requestByZipCode(zipCode: Long, days: Int): ForecastList = source.firstResult &#123;</span><br><span class="line">        requestSource(it, days, zipCode)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private fun requestSource(source: ForecastDataSource, days: Int, zipCode: Long): ForecastList? &#123;</span><br><span class="line">        val res = source.requestForecastByZipCode(zipCode, todayTimeSpan())</span><br><span class="line">        return if (res != null &amp;&amp; res.size &gt;= days) res else null</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private fun todayTimeSpan() = System.currentTimeMillis() / DAY_IN_MILLIS * DAY_IN_MILLIS</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/03/25/Kotlin-for-Android-七/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/03/24/Kotlin-for-Android-六/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/24/Kotlin-for-Android-六/" itemprop="url">Kotlin for Android(六)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-24T13:45:00+08:00">
                2018-03-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kotlin/" itemprop="url" rel="index">
                    <span itemprop="name">Kotlin</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/24/Kotlin-for-Android-六/" class="leancloud_visitors" data-flag-title="Kotlin for Android(六)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="Kotlin中的null安全"><a href="#Kotlin中的null安全" class="headerlink" title="Kotlin中的null安全"></a>Kotlin中的null安全</h4><ul>
<li><p>在Kotlin中一切都是对象（甚至是Java中原始数据类型），一切都是可null的。所以，当然我们可以有一个可null的integer,检查了一个对象的可null性，之后这个对象就会自动转型成不可null类型，这就是Kotlin编译器的智能转换,在 if 中， a 从 Int? 变成了 Int ，所以我们可以不需要再检查可null性而直接使用它,if 代码之外，又得检查处理,仅仅在变量当前不能被改变的时候才有效<strong>val 属性或者本地（ val or var ）变量</strong>，因为这个value可能被另外的线程修改，这时前面的检查会返回false</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">val a:Int?=null</span><br><span class="line">...</span><br><span class="line">if(a!=null)&#123;</span><br><span class="line">a.toString()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">简化代码</span><br><span class="line">val a: Int? = null</span><br><span class="line">...</span><br><span class="line">a?.toString()</span><br><span class="line"></span><br><span class="line">val a:Int? = null</span><br><span class="line">val myString = a?.toString() ?: &quot;&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>throw 和 return 都是表达式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val myString = a?.toString() ?: return false</span><br><span class="line">val myString = a?.toString() ?: throw IllegalStateException()</span><br></pre></td></tr></table></figure>
</li>
<li><p>我们确定我们是在用一个非null变量，但是他的类型却是可null的。我们可以使用 <code>!!</code>操作符来强制编译器执行可null类型时跳过限制检查,此时确定了不为null，直接定义为非null对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val a: Int? = null</span><br><span class="line">a!!.toString() throw KotlinNullPointerException</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="可null性和Java库"><a href="#可null性和Java库" class="headerlink" title="可null性和Java库"></a>可null性和Java库</h4><ul>
<li><p>Java中在一些获取对象的方法在Kotlin中显示返回 <code>Any!</code>这表示让开发者自己决定是否这个变量是否可null</p>
<img src="http://p4n1d4izv.bkt.clouddn.com/images/nullable.png">
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class NullTest &#123;</span><br><span class="line">    @Nullable</span><br><span class="line">    public Object getObject()&#123;</span><br><span class="line">        return &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编译不通过</p>
<img src="http://p4n1d4izv.bkt.clouddn.com/images/nulltest.png"></li>
<li>比如重写 Activity 的 onCraete 函数，我们可以决定是否让 savedInstanceState 可null,都会被编译，但是第二种是错误的，因为一个Activity很可能接收到一个null的bundle<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">&#125;</span><br><span class="line">override fun onCreate(savedInstanceState: Bundle) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/03/24/Kotlin-for-Android-五/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/24/Kotlin-for-Android-五/" itemprop="url">Kotlin for Android (五)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-24T01:18:00+08:00">
                2018-03-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kotlin/" itemprop="url" rel="index">
                    <span itemprop="name">Kotlin</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/24/Kotlin-for-Android-五/" class="leancloud_visitors" data-flag-title="Kotlin for Android (五)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="创建SQLiteHelper"><a href="#创建SQLiteHelper" class="headerlink" title="创建SQLiteHelper"></a>创建SQLiteHelper</h4><p>一般使用SqliteOpenHelper 去调用 getReadableDatabase() 或者 getWritableDatabase() ，然后我们可以执行我们的搜索并拿到结果。在这之后，我们不能忘记调用 close()</p>
<h5 id="ManagedSqliteOpenHelper"><a href="#ManagedSqliteOpenHelper" class="headerlink" title="ManagedSqliteOpenHelper"></a>ManagedSqliteOpenHelper</h5><ul>
<li>函数中，最后一行表示返回值。因为T没有任何的限制，所以我们可以返回任何对象。甚至如果我们不想返回任何值就使用 Unit,<code>try-finally</code>保证关闭数据库<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">val result = forecastDbHelper.use &#123;</span><br><span class="line">val queriedObject = ...</span><br><span class="line">queriedObject</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fun &lt;T&gt; use(f: SQLiteDatabase.() -&gt; T): T &#123;</span><br><span class="line">     try &#123;</span><br><span class="line">          return openDatabase().f()</span><br><span class="line">     &#125; finally &#123;</span><br><span class="line">          closeDatabase()</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="定义表"><a href="#定义表" class="headerlink" title="定义表"></a>定义表</h5><ul>
<li>CityForecastTable 提供了表的名字还有需要列：一个id（这个城市的zipCode），城市的名称和所在国家,DayForecast天气信息<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">object CityForecastTable &#123;</span><br><span class="line">val NAME = &quot;CityForecast&quot;</span><br><span class="line">val ID = &quot;_id&quot;</span><br><span class="line">val CITY = &quot;city&quot;</span><br><span class="line">val COUNTRY = &quot;country&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">object DayForecastTable &#123;</span><br><span class="line">val NAME = &quot;DayForecast&quot;</span><br><span class="line">val ID = &quot;_id&quot;</span><br><span class="line">val DATE = &quot;date&quot;</span><br><span class="line">val DESCRIPTION = &quot;description&quot;</span><br><span class="line">val HIGH = &quot;high&quot;</span><br><span class="line">val LOW = &quot;low&quot;</span><br><span class="line">val ICON_URL = &quot;iconUrl&quot;</span><br><span class="line">val CITY_ID = &quot;cityId&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="实现SqliteOpenHelper"><a href="#实现SqliteOpenHelper" class="headerlink" title="实现SqliteOpenHelper"></a>实现SqliteOpenHelper</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fun SQLiteDatabase.createTable(tableName: String, ifNotExists: Boolean = false, vararg columns: Pair&lt;String, SqlType&gt;) &#123;</span><br><span class="line">    val escapedTableName = tableName.replace(&quot;`&quot;, &quot;``&quot;)</span><br><span class="line">    val ifNotExistsText = if (ifNotExists) &quot;IF NOT EXISTS&quot; else &quot;&quot;</span><br><span class="line">    execSQL(</span><br><span class="line">        columns.map &#123; col -&gt;</span><br><span class="line">            &quot;$&#123;col.first&#125; $&#123;col.second.render()&#125;&quot;</span><br><span class="line">        &#125;.joinToString(&quot;, &quot;, prefix = &quot;CREATE TABLE $ifNotExistsText `$escapedTableName`(&quot;, postfix = &quot;);&quot;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">db.createTable(CityForecastTable.NAME, true,</span><br><span class="line">Pair(CityForecastTable.ID, INTEGER + PRIMARY_KEY),</span><br><span class="line">Pair(CityForecastTable.CITY, TEXT),</span><br><span class="line">Pair(CityForecastTable.COUNTRY, TEXT))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第一个参数是表的名称<br>第二个参数，当是true的时候，创建之前会检查这个表是否存在。<br>第三个参数是一个 Pair 类型的 vararg 参数。 vararg 也存在在Java中，<br>这是一种在一个函数中传入联系很多相同类型的参数。这个函数也接收一个对<br>象数组。<br>Anko中有一种叫做 SqlType 的特殊类型，它可以与 SqlTypeModifiers 混合，<br>比如 PRIMARY_KEY 。 + 操作符像之前那样被重写了。这个 plus 函数会把两者<br>通过合适的方式结合起来，然后返回一个新的 SqlType<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fun SqlType.plus(m: SqlTypeModifier) : SqlType &#123;</span><br><span class="line">return SqlTypeImpl(name, if (modifier == null) m.toString()</span><br><span class="line">else &quot;$modifier $m&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<ul>
<li><code>public fun &lt;A, B&gt; A.to(that: B): Pair&lt;A, B&gt; = Pair(this, that)</code>因为带有一个函数参数的函数可以被用于inline，所以结果非常清晰：<code>val pair = object1 to object2</code></li>
<li><p>简化后的代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">class ForecastDbHelper(ctx: Context = App.instance) : ManagedSQLiteOpenHelper(App.instance,</span><br><span class="line">        ForecastDbHelper.DB_NAME, null, ForecastDbHelper.DB_VERSION) &#123;</span><br><span class="line">    override fun onCreate(db: SQLiteDatabase) &#123;</span><br><span class="line">        db.createTable(CityForecastTable.NAME, true,</span><br><span class="line">                CityForecastTable.ID to INTEGER + PRIMARY_KEY,</span><br><span class="line">                CityForecastTable.CITY to TEXT,</span><br><span class="line">                CityForecastTable.COUNTRY to TEXT)</span><br><span class="line"></span><br><span class="line">        db.createTable(DayForecastTable.NAME, true,</span><br><span class="line">                DayForecastTable.ID to INTEGER + PRIMARY_KEY,</span><br><span class="line">                DayForecastTable.DATE to INTEGER,</span><br><span class="line">                DayForecastTable.DESCRIPTION to TEXT,</span><br><span class="line">                DayForecastTable.HIGH to INTEGER,</span><br><span class="line">                DayForecastTable.LOW to INTEGER,</span><br><span class="line">                DayForecastTable.ICON_URL to TEXT,</span><br><span class="line">                DayForecastTable.CITY_ID to INTEGER)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override fun onUpgrade(db: SQLiteDatabase, oldVersion: Int, newVersion: Int) &#123;</span><br><span class="line">        db.dropTable(CityForecastTable.NAME, true)</span><br><span class="line">        db.dropTable(DayForecastTable.NAME, true)</span><br><span class="line">        onCreate(db)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    companion object &#123;</span><br><span class="line">        val DB_NAME = &quot;forecast.db&quot;</span><br><span class="line">        val DB_VERSION = 1</span><br><span class="line">        val instance: ForecastDbHelper by lazy &#123;</span><br><span class="line">            ForecastDbHelper()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>instance 这个属性使用了 lazy 委托，它表示直到它真的被调用才会被创建。<br>如果数据库没有被使用，就没有去创建这个对象。一般 lazy 委托的代码块可以阻止在多个不同的线程中创建多个对象。这个只会发生在两个线程在同时访问这个 instance 对象， lazy 委托是线程安全的</p>
</blockquote>
</li>
</ul>
<h4 id="集合和函数操作符"><a href="#集合和函数操作符" class="headerlink" title="集合和函数操作符"></a>集合和函数操作符</h4><ul>
<li>本地接口<blockquote>
<p>Iterable：父类。所有我们可以遍历一系列的都是实现这个接口<br>MutableIterable：一个支持遍历的同时可以执行删除的Iterables<br>Collection：这个类相是一个范性集合。我们通过函数访问可以返回集合的size、是否为空、是否包含一个或者一些item。这个集合的所有方法提供查询，因为collection是不可修改的<br>MutableCollection：一个支持增加和删除item的Collection。它提供了额外的函数，比如 add 、 remove 、 clear 等等<br>List：可能是最流行的集合类型。它是一个范性有序的集合。因为它的有序，我们可以使用 get 函数通过position来访问<br>MutableList：一个支持增加和删除item的List<br>Set：一个无序并不支持重复item的集合<br>MutableSet：一个支持增加和删除item的Set<br>Map：一个key-value对的collection。key在map中是唯一的，也就是说不能有两对key是一样的键值对存在于一个map中<br>MutableMap：一个支持增加和删除item的map</p>
</blockquote>
<h5 id="总数操作符"><a href="#总数操作符" class="headerlink" title="总数操作符"></a>总数操作符</h5></li>
<li><p>any 如果至少有一个元素符合给出的判断条件，则返回true</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val list = listOf(1, 2, 3, 4, 5, 6)</span><br><span class="line">assertTrue(list.any &#123; it % 2 == 0 &#125;)  true</span><br><span class="line">assertFalse(list.any &#123; it &gt; 10 &#125;)    false</span><br></pre></td></tr></table></figure>
</li>
<li><p>all 如果全部的元素符合给出的判断条件，则返回true</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">assertTrue(list.all &#123; it &lt; 10 &#125;)  true</span><br><span class="line">assertFalse(list.all &#123; it % 2 == 0 &#125;)  false</span><br></pre></td></tr></table></figure>
</li>
<li><p>count 返回符合给出判断条件的元素总数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(3, list.count &#123; it % 2 == 0 &#125;) true</span><br></pre></td></tr></table></figure>
</li>
<li><p>fold 在一个初始值的基础上从第一项到最后一项通过一个函数累计所有的元素,所有元素相加，并加上初始值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(25, list.fold(4) &#123; total, next -&gt; total + next &#125;) true</span><br></pre></td></tr></table></figure>
</li>
<li><p>foldRight 与 fold 一样，但是顺序是从最后一项到第一项</p>
</li>
<li><p>foreEach 遍历所有元素，并执行给定的操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.forEach &#123; println(it) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>forEachIndexed 与 forEach ，但是我们同时可以得到元素的index</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.forEachIndexed &#123; index, i -&gt; println(&quot;position $index value $i&quot;) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>max/min 返回最大值/最小值，没有返回null</p>
</li>
<li><p>maxBy/minBy 根据给定的函数返回最大/最小的一项，如果没有则返回null</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// The element whose negative is greater</span><br><span class="line">assertEquals(1, list.maxBy &#123; -it &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>none 如果没有任何元素与给定的函数匹配，则返回true</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// No elements are divisible by 7</span><br><span class="line">assertTrue(list.none &#123; it % 7 == 0 &#125;) true</span><br></pre></td></tr></table></figure>
</li>
<li><p>reduce与 fold 一样，但是没有一个初始值。通过一个函数从第一项到最后一项进行累<br>计</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(21, list.reduce &#123; total, next -&gt; total + next &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>reduceRight与 reduce 一样，但是顺序是从最后一项到第一项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(21, list.reduceRight &#123; total, next -&gt; total + next</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>sumBy返回所有每一项通过函数转换之后的数据的总和</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(3, list.sumBy &#123; it % 2 &#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="过滤操作符"><a href="#过滤操作符" class="headerlink" title="过滤操作符"></a>过滤操作符</h5><ul>
<li><p>drop返回包含去掉前n个元素的所有元素的列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(listOf(5, 6), list.drop(4))</span><br></pre></td></tr></table></figure>
</li>
<li><p>dropWhile返回根据给定函数从第一项开始去掉指定元素的列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(listOf(3, 4, 5, 6), list.dropWhile &#123; it &lt; 3 &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>dropLastWhile返回根据给定函数从最后一项开始去掉指定元素的列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(listOf(1, 2, 3, 4), list.dropLastWhile &#123; it &gt; 4 &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>filter过滤所有符合给定函数条件的元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(listOf(2, 4, 6), list.filter &#123; it % 2 == 0 &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val listWithNull = listOf(1, 2, null)</span><br><span class="line">Log.e(tag, &quot;filterNotNull &quot; + listWithNull.filterNotNull())</span><br><span class="line"></span><br><span class="line">filterNotNull [1, 2]</span><br></pre></td></tr></table></figure>
</li>
<li><p>slice 过滤一个list中指定index的元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Log.e(tag, &quot;slice &quot; + list.slice(listOf(1, 2, 4)))</span><br><span class="line"></span><br><span class="line">slice [2, 3, 5]</span><br></pre></td></tr></table></figure>
</li>
<li><p>take返回从第一个开始的n个元素, takeLast返回从最后一个开始的n个元素,takeWhile返回从第一个开始符合给定函数条件的元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(listOf(1, 2), list.take(2))</span><br><span class="line">assertEquals(listOf(5, 6), list.takeLast(2))</span><br><span class="line">assertEquals(listOf(1, 2), list.takeWhile &#123; it &lt; 3 &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>flatMap遍历所有的元素，为每一个创建一个集合，最后把所有的集合放在一个集合中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(listOf(1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7),</span><br><span class="line">list.flatMap &#123; listOf(it, it + 1) &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>groupBy 返回一个根据给定函数分组后的map</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(mapOf(&quot;odd&quot; to listOf(1, 3, 5), &quot;even&quot; to listOf(2,</span><br><span class="line">4, 6)), list.groupBy &#123; if (it % 2 == 0) &quot;even&quot; else &quot;odd&quot; &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>map返回一个每一个元素根据给定的函数转换所组成的List</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(listOf(2, 4, 6, 8, 10, 12), list.map &#123; it * 2 &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>mapIndexed返回一个每一个元素根据给定的包含元素index的函数转换所组成的List</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(listOf (0, 2, 6, 12, 20, 30), list.mapIndexed &#123; ind</span><br><span class="line">ex, it -&gt; index * it &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>mapNotNull返回一个每一个非null元素根据给定的函数转换所组成的List</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">assertEquals(listOf(2, 4, 6, 8), listWithNull.mapNotNull &#123; it * 2</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">        val list = listOf(1, 1, 3, 4, 5, 6)</span><br><span class="line">        Log.e(tag, &quot;any1 &quot; + list.any &#123; it % 2 == 0 &#125;)</span><br><span class="line">        Log.e(tag, &quot;any2 &quot; + list.any &#123; it &gt; 10 &#125;)</span><br><span class="line">        Log.e(tag, &quot;all1 &quot; + list.all &#123; it &lt; 10 &#125;)</span><br><span class="line">        Log.e(tag, &quot;all2 &quot; + list.all &#123; it % 2 == 0 &#125;)</span><br><span class="line">        Log.e(tag, &quot;count &quot; + list.count &#123; it % 2 == 0 &#125;)</span><br><span class="line">        Log.e(tag, &quot;fold &quot; + list.fold(4) &#123; total, next -&gt; total + next &#125;)</span><br><span class="line">        Log.e(tag, &quot;foldRight &quot; + list.foldRight(4) &#123; total, next -&gt; total + next &#125;)</span><br><span class="line">        list.forEach &#123; println(it) &#125;</span><br><span class="line">        list.forEachIndexed &#123; index, i -&gt; println(&quot;position $index value $i&quot;) &#125;</span><br><span class="line">        Log.e(tag, &quot;max &quot; + list.max())</span><br><span class="line">        Log.e(tag, &quot;maxBy &quot; + list.maxBy &#123; -it &#125;)</span><br><span class="line">        Log.e(tag, &quot;min &quot; + list.min())</span><br><span class="line">        Log.e(tag, &quot;minBy &quot; + list.minBy &#123; -it &#125;)</span><br><span class="line">        Log.e(tag, &quot;none &quot; + list.none &#123; it % 7 == 0 &#125;)</span><br><span class="line">        Log.e(tag, &quot;reduce &quot; + list.reduce &#123; total, next -&gt; total + next &#125;)</span><br><span class="line">        Log.e(tag, &quot;reduce right &quot; + list.reduceRight &#123; total, next -&gt; total + next &#125;)</span><br><span class="line">        Log.e(tag, &quot;sumBy &quot; + list.sumBy &#123; it % 2 &#125;)</span><br><span class="line">        Log.e(tag, &quot;drop &quot; + list.drop(4))</span><br><span class="line">        Log.e(tag, &quot;dropWhile &quot; + list.dropWhile &#123; it &gt; 2 &#125;)</span><br><span class="line">        Log.e(tag, &quot;dropLastWhile &quot; + list.dropLastWhile &#123; it &gt; 2 &#125;)</span><br><span class="line">        Log.e(tag, &quot;filter &quot; + list.filter &#123; it &gt; 2 &#125;)</span><br><span class="line">        Log.e(tag, &quot;filterNot &quot; + list.filterNot &#123; it &gt; 2 &#125;)</span><br><span class="line">        val listWithNull = listOf(1, 2, null)</span><br><span class="line">        Log.e(tag, &quot;filterNotNull &quot; + listWithNull.filterNotNull())</span><br><span class="line">        Log.e(tag, &quot;slice &quot; + list.slice(listOf(1, 2, 4)))</span><br><span class="line">        Log.e(tag, &quot;flatMap &quot; + list.flatMap &#123; listOf(it, it + 1) &#125;)</span><br><span class="line">        Log.e(tag, &quot;groupBy &quot; + list.groupBy &#123; if (it % 2 == 0) &quot;even&quot; else &quot;odd&quot; &#125;)</span><br><span class="line">        Log.e(tag, &quot;map &quot; + list.map &#123; it * 2 &#125;)</span><br><span class="line">        Log.e(tag, &quot;partition &quot; + list.partition &#123; it % 2 == 0 &#125;)</span><br><span class="line">        Log.e(tag, &quot;plus &quot; + list + listOf(7, 8))</span><br><span class="line">        Log.e(tag, &quot;zip &quot; + list.zip(listOf(7, 4, 9, 8)))</span><br><span class="line">        Log.e(tag, &quot;unzip &quot; + listOf(Pair(5, 7), Pair(6, 8)).unzip())</span><br><span class="line"></span><br><span class="line">E/MainActivity: any1 true</span><br><span class="line">                any2 false</span><br><span class="line">                all1 true</span><br><span class="line">                all2 false</span><br><span class="line">                count 2</span><br><span class="line">                fold 24</span><br><span class="line">                foldRight 24</span><br><span class="line">I/System.out: 1</span><br><span class="line">              1</span><br><span class="line">              3</span><br><span class="line">              4</span><br><span class="line">              5</span><br><span class="line">              6</span><br><span class="line">              position 0 value 1</span><br><span class="line">              position 1 value 1</span><br><span class="line">              position 2 value 3</span><br><span class="line">              position 3 value 4</span><br><span class="line">              position 4 value 5</span><br><span class="line">              position 5 value 6</span><br><span class="line">E/MainActivity: max 6</span><br><span class="line">                maxBy 1</span><br><span class="line">                min 1</span><br><span class="line">E/MainActivity: minBy 6</span><br><span class="line">                none true</span><br><span class="line">                reduce 20</span><br><span class="line">                reduce right 20</span><br><span class="line">                sumBy 4</span><br><span class="line">                drop [5, 6]</span><br><span class="line">                dropWhile [1, 1, 3, 4, 5, 6]</span><br><span class="line">                dropLastWhile [1, 1]</span><br><span class="line">                filter [3, 4, 5, 6]</span><br><span class="line">                filterNot [1, 1]</span><br><span class="line">                filterNotNull [1, 2]</span><br><span class="line">                slice [1, 3, 5]</span><br><span class="line">                flatMap [1, 2, 1, 2, 3, 4, 4, 5, 5, 6, 6, 7]</span><br><span class="line">                groupBy &#123;odd=[1, 1, 3, 5], even=[4, 6]&#125;</span><br><span class="line">                map [2, 2, 6, 8, 10, 12]</span><br><span class="line">                partition ([4, 6], [1, 1, 3, 5])</span><br><span class="line">                plus [1, 1, 3, 4, 5, 6][7, 8]</span><br><span class="line">                zip [(1, 7), (1, 4), (3, 9), (4, 8)]</span><br><span class="line">                unzip ([5, 6], [7, 8])</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="元素操作符"><a href="#元素操作符" class="headerlink" title="元素操作符"></a>元素操作符</h5><img src="http://p4n1d4izv.bkt.clouddn.com/images/element1.png">
<img src="http://p4n1d4izv.bkt.clouddn.com/images/element2.png">
<img src="http://p4n1d4izv.bkt.clouddn.com/images/element3.png">
<h5 id="生产操作符"><a href="#生产操作符" class="headerlink" title="生产操作符"></a>生产操作符</h5><img src="http://p4n1d4izv.bkt.clouddn.com/images/produce1.png">
<img src="http://p4n1d4izv.bkt.clouddn.com/images/produce2.png">
<h5 id="顺序操作符"><a href="#顺序操作符" class="headerlink" title="顺序操作符"></a>顺序操作符</h5><img src="http://p4n1d4izv.bkt.clouddn.com/images/sort1.png">
<h4 id="创建数据库model"><a href="#创建数据库model" class="headerlink" title="创建数据库model"></a>创建数据库model</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * SQLite表与对象之间的互相映射</span><br><span class="line"> */</span><br><span class="line">class CityForecast(val map: MutableMap&lt;String, Any?&gt;,</span><br><span class="line">                   val dailyForecast: List&lt;DayForecast&gt;) &#123;</span><br><span class="line">    var _id: Long by map</span><br><span class="line">    var city: String by map</span><br><span class="line">    var country: String by map</span><br><span class="line"></span><br><span class="line">    constructor(id: Long, city: String, country: String,</span><br><span class="line">                dailyForecast: List&lt;DayForecast&gt;)</span><br><span class="line">            : this(HashMap(), dailyForecast) &#123;</span><br><span class="line">        this._id = id</span><br><span class="line">        this.city = city</span><br><span class="line">        this.country = country</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**不同之处就是不需要设置id，因为它将</span><br><span class="line">通过SQLite自增长*/</span><br><span class="line">class DayForecast(val map: MutableMap&lt;String, Any?&gt;) &#123;</span><br><span class="line">    var _id: Long by map</span><br><span class="line">    var date: Long by map</span><br><span class="line">    var description: String by map</span><br><span class="line">    var high: Long by map</span><br><span class="line">    var low: Long by map</span><br><span class="line">    var iconUrl: String by map</span><br><span class="line">    var cityId: Long by map</span><br><span class="line"></span><br><span class="line">    constructor(date: Long, description: String, high: Long,</span><br><span class="line">                low: Long, iconUrl: String, cityId: Long) : this(HashMap()) &#123;</span><br><span class="line">        this.date = date</span><br><span class="line">        this.description = description</span><br><span class="line">        this.high = high</span><br><span class="line">        this.low = low</span><br><span class="line">        this.iconUrl = iconUrl</span><br><span class="line">        this.cityId = cityId</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="写入和查询数据库"><a href="#写入和查询数据库" class="headerlink" title="写入和查询数据库"></a>写入和查询数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">class ForecastDb(val forecastDbHelper: ForecastDbHelper = ForecastDbHelper.instance,</span><br><span class="line">                 val dataMapper: DbDataMapper = DbDataMapper()) &#123;</span><br><span class="line"></span><br><span class="line">    //dailyRequest 是查询语句中 where 的一部分。它是 whereSimple 函</span><br><span class="line">    //数需要的第一个参数，这与我们用一般的helper做的方式很相似</span><br><span class="line">    fun requestForecastByZipcode(zipCode: String, date: Date) = forecastDbHelper.use &#123;</span><br><span class="line">        val dailyRequest = &quot;$&#123;DayForecastTable.CITY_ID&#125;=? &quot; +</span><br><span class="line">                &quot;AND $&#123;DayForecastTable.DATE&#125;&gt;=?&quot;</span><br><span class="line">        val dailyForecast = select(DayForecastTable.NAME)</span><br><span class="line">                .whereSimple(dailyRequest, zipCode, date.toString())</span><br><span class="line">                .parseList &#123; DayForecast(HashMap(it)) &#125;</span><br><span class="line"></span><br><span class="line">//        简化写法</span><br><span class="line">//        val dailyRequest = &quot;$&#123;DayForecastTable.CITY_ID&#125; = &#123;id&#125;&quot; + &quot;AND $</span><br><span class="line">//        &#123;DayForecastTable.DATE&#125; &gt;= &#123;date&#125;&quot;</span><br><span class="line">//        val dailyForecast = select(DayForecastTable.NAME)</span><br><span class="line">//                .where(dailyRequest, &quot;id&quot; to zipCode, &quot;date&quot; to date)</span><br><span class="line">//                .parseList &#123; DayForecast(HashMap(it)) &#125;</span><br><span class="line">        val city = select(CityForecastTable.NAME)</span><br><span class="line">                .whereSimple(&quot;$&#123;CityForecastTable.ID&#125; = ?&quot;, zipCode)</span><br><span class="line">                .parseOpt &#123; CityForecast(HashMap(it), dailyForecast) &#125;</span><br><span class="line">        city?.let &#123; dataMapper.convertToDomain(it) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fun saveForecast(forecastList: ForecastList) = forecastDbHelper.use &#123;</span><br><span class="line">        clear(DayForecastTable.NAME)</span><br><span class="line">        clear(CityForecastTable.NAME)</span><br><span class="line">        with(dataMapper.convertFromDomain(forecastList)) &#123;</span><br><span class="line">            insert(CityForecastTable.NAME, *map.toVarargArray())</span><br><span class="line">            dailyForecast.forEach &#123; insert(DayForecastTable.NAME, *it.map.toVarargArray()) &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>DbDataMapper使用<code>with</code>简化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">class DbDataMapper &#123;</span><br><span class="line"></span><br><span class="line">    fun convertFromDomain(forecastList: ForecastList) = with(forecastList) &#123;</span><br><span class="line">        val daily = dailyForecast.map &#123; convertDayFromDomain(id, it) &#125;</span><br><span class="line">        CityForecast(id, city, country, daily)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private fun convertDayFromDomain(cityId: Long, forecast: Forecast) = with(forecast) &#123;</span><br><span class="line">        DayForecast(date, description, high, low, iconUrl, cityId)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fun convertToDomain(forecast: CityForecast) = with(forecast) &#123;</span><br><span class="line">        val daily = dailyForecast.map &#123; convertDayToDomain(it) &#125;</span><br><span class="line">        ForecastList(_id, city, country, daily)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fun convertDayToDomain(dayForecast: DayForecast) = with(dayForecast) &#123;</span><br><span class="line">        Forecast(_id, date, description, high, low, iconUrl)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Map,SelectQueryBuilder 扩展函数 它需要一个表名和一个 vararg 修饰的 Pair&lt;String, Any&gt; 作为参数。这个函数会把 vararg 转换成Android SDK需要的 ContentValues 对象。所以任务组成是把 map 转换成一个 vararg 数组,在toVarargArray 函数结果前面使用 * 表示这个array会被分解成为一个 vararg 参数,这个在Java中是自动处理的，但是我们需要在Kotlin中明确指明，通过 map 的使用，可以用很简单的方式把类转换为数据表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">fun &lt;K, V : Any&gt; Map&lt;K, V?&gt;.toVarargArray(): Array&lt;out Pair&lt;K, V&gt;&gt; =</span><br><span class="line">        map(&#123; Pair(it.key, it.value!!) &#125;).toTypedArray()</span><br><span class="line"></span><br><span class="line">fun &lt;T : Any&gt; SelectQueryBuilder.parseList(parser: (Map&lt;String, Any?&gt;) -&gt; T): List&lt;T&gt; =</span><br><span class="line">        parseList(object : MapRowParser&lt;T&gt; &#123;</span><br><span class="line">            override fun parseRow(columns: Map&lt;String, Any?&gt;): T = parser(columns)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">fun &lt;T : Any&gt; SelectQueryBuilder.parseOpt(parser: (Map&lt;String, Any?&gt;) -&gt; T): T? =</span><br><span class="line">        parseOpt(object : MapRowParser&lt;T&gt; &#123;</span><br><span class="line">            override fun parseRow(columns: Map&lt;String, Any?&gt;): T = parser(columns)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">fun SQLiteDatabase.clear(tableName: String) &#123;</span><br><span class="line">    execSQL(&quot;delete from $tableName&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/03/23/kotlin-for-Android-四/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/23/kotlin-for-Android-四/" itemprop="url">Kotlin for Android (四)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-23T20:08:00+08:00">
                2018-03-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kotlin/" itemprop="url" rel="index">
                    <span itemprop="name">Kotlin</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/23/kotlin-for-Android-四/" class="leancloud_visitors" data-flag-title="Kotlin for Android (四)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="Application单例化和属性的Delegated"><a href="#Application单例化和属性的Delegated" class="headerlink" title="Application单例化和属性的Delegated"></a>Application单例化和属性的Delegated</h4><p>需要有一个更简单的访问application context的方式</p>
<h5 id="Application单例化"><a href="#Application单例化" class="headerlink" title="Application单例化"></a>Application单例化</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class App : Application() &#123;</span><br><span class="line">companion object &#123;</span><br><span class="line">private var instance: Application? = null</span><br><span class="line">fun instance() = instance!!</span><br><span class="line">&#125;</span><br><span class="line">override fun onCreate() &#123;</span><br><span class="line">super.onCreate()</span><br><span class="line">instance = this</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Android有一个问题，就是我们不能去控制很多类的构造函数。比如，我们不能初<br>始化一个非null属性，因为它的值需要在构造函数中去定义。所以我们需要一个可<br>null的变量，和一个返回非null值的函数。我们知道我们一直都有一个 App 实例，<br>但是在它调用 onCreate 之前我们不能去操作任何事情，所以我们为了安全性，我<br>们假设 instance() 函数将会总是返回一个非null的 app 实例。但是这个方案看起来有点不自然。我们需要定义个一个属性（已经有了getter和setter），然后通过一个函数来返回那个属性。我们有其他方法去达到相似的效果么？是的，我们可以通过委托这个属性的值给另外一个类。这个就是我们知道的委托属性</p>
</blockquote>
<h5 id="委托属性"><a href="#委托属性" class="headerlink" title="委托属性"></a>委托属性</h5><ul>
<li><p>属性委托的结构如下：这个T是委托属性的类型。 getValue 函数接收一个类的引用和一个属性的元数据。 setValue 函数又接收了一个被设置的值。如果这个属性是不可修改(val)，就会只有一个 getValue 函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Delegate&lt;T&gt; : ReadWriteProperty&lt;Any?, T&gt; &#123;</span><br><span class="line">fun getValue(thisRef: Any?, property: KProperty&lt;*&gt;): T &#123;</span><br><span class="line">return ...</span><br><span class="line">&#125;</span><br><span class="line">fun setValue(thisRef: Any?, property: KProperty&lt;*&gt;, value: T)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>示例属性委托怎么设置,by 这个关键字来指定一个委托对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class Example &#123;</span><br><span class="line">var p: String by Delegate()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="标准委托"><a href="#标准委托" class="headerlink" title="标准委托"></a>标准委托</h5><ul>
<li><p>Lazy<br>它包含一个lambda，当第一次执行 getValue 的时候这个lambda会被调用，所以<br>这个属性可以被延迟初始化。之后的调用都只会返回同一个值,当我们在它们第一次真正调用之前不是必须需要它们的时候。我们可以节省内存，在这些属性真正需要前不进行初始化，database并没有被真正初始化，直到第一次调用 onCreate 时。在那之后，我们才确保applicationContext存在，并且已经准备好可以被使用了。 lazy 操作符是线程安全的。如果你不担心多线程问题或者想提高更多的性能，你也可以使用lazy(LazyThreadSafeMode.NONE){ … }</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class App : Application() &#123;</span><br><span class="line">val database: SQLiteOpenHelper by lazy &#123;</span><br><span class="line">MyDatabaseHelper(applicationContext)</span><br><span class="line">&#125;</span><br><span class="line">override fun onCreate() &#123;</span><br><span class="line">super.onCreate()</span><br><span class="line">val db = database.writableDatabase</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Observable这个委托会帮我们监测我们希望观察的属性的变化。当被观察属性的 set 方法被调用的时候，它就会自动执行我们指定的lambda表达式。所以一旦该属性被赋了新的值，我们就会接收到被委托的属性、旧值和新值,下面的示例是一些我们需要关心的ViewMode，每次值被修改了，就会保存它们到数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class ViewModel(val db: MyDatabase) &#123;</span><br><span class="line">var myProperty by Delegates.observable(&quot;&quot;) &#123;</span><br><span class="line">d, old, new -&gt;</span><br><span class="line">db.saveChanges(this, new)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Vetoable 这是一个特殊的 observable ，它让你决定是否这个值需要被保存。它可以被用于在真正保存之前进行一些条件判断,下面的示例，允许在新的值是正数的时候执行保存。在lambda中，最后一行表示返回值。你不需要使用return关键字（实质上不能被编译）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var positiveNumber = Delegates.vetoable(0) &#123;</span><br><span class="line">d, old, new -&gt;</span><br><span class="line">new &gt;= 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>NotNull 含有一个可null的变量并会在我们设置这个属性的时候分配一个真实的值。如果这个值在被获取之前没有被分配，它就会抛出一个异常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class App : Application() &#123;</span><br><span class="line">companion object &#123;</span><br><span class="line">var instance: App by Delegates.notNull()</span><br><span class="line">&#125;</span><br><span class="line">override fun onCreate() &#123;</span><br><span class="line">super.onCreate()</span><br><span class="line">instance = this</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>从Map中映射值 属性的值会从一个map中获取value，属性的名字对应这个map中的key,如果我们importkotlin.properties.getValue ，我们可以从构造函数映射到 val 属性来得到一个不可修改的map。如果我们想去修改map和属性，我们也可以import kotlin.properties.setValue 。类需要一个 MutableMap 作为构造函数的参数</p>
</li>
<li><p>想象我们从一个Json中加载了一个配置类，然后分配它们的key和value到一个map中。我们可以仅仅通过传入一个map的构造函数来创建一个实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import kotlin.properties.getValue</span><br><span class="line">class Configuration(map: Map&lt;String, Any?&gt;) &#123;</span><br><span class="line">val width: Int by map</span><br><span class="line">val height: Int by map</span><br><span class="line">val dp: Int by map</span><br><span class="line">val deviceName: String by map</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建一个map</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">conf = Configuration(mapOf(</span><br><span class="line">&quot;width&quot; to 1080,</span><br><span class="line">&quot;height&quot; to 720,</span><br><span class="line">&quot;dp&quot; to 240,</span><br><span class="line">&quot;deviceName&quot; to &quot;mydevice&quot;</span><br><span class="line">))</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义委托 创建一个类然后继承 ReadWriteProperty ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private class NotNullSingleValueVar&lt;T&gt;() : ReadWriteProperty&lt;Any</span><br><span class="line">?, T&gt; &#123;</span><br><span class="line">override fun getValue(thisRef: Any?, property: KProperty</span><br><span class="line">&lt;*&gt;): T &#123;</span><br><span class="line">throw UnsupportedOperationException()</span><br><span class="line">&#125;</span><br><span class="line">override fun setValue(thisRef: Any?, property: KProperty</span><br><span class="line">&lt;*&gt;, value: T) &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>这个委托可以作用在任何非null的类型。它接收任何类型的引用，然后像getter和setter那样使用T。现在我们需要去实现这些函数</p>
<blockquote>
<p>Getter函数 如果已经被初始化，则会返回一个值，否则会抛异常<br>Setter函数 如果仍然是null，则赋值，否则会抛异常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">private class NotNullSingleValueVar&lt;T&gt;() : ReadWriteProperty&lt;Any</span><br><span class="line">?, T&gt; &#123;</span><br><span class="line">private var value: T? = null</span><br><span class="line">override fun getValue(thisRef: Any?, property: KProperty&lt;*&gt;)</span><br><span class="line">: T &#123;</span><br><span class="line">return value ?: throw IllegalStateException(&quot;$&#123;desc.name</span><br><span class="line">&#125; &quot; +</span><br><span class="line">&quot;not initialized&quot;)</span><br><span class="line">&#125;</span><br><span class="line">override fun setValue(thisRef: Any?, property: KProperty&lt;*&gt;,</span><br><span class="line">value: T) &#123;</span><br><span class="line">this.value = if (this.value == null) value</span><br><span class="line">else throw IllegalStateException(&quot;$&#123;desc.name&#125; already i</span><br><span class="line">nitialized&quot;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>使用上述委托示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">object DelegatesExt &#123;</span><br><span class="line">fun notNullSingleValue&lt;T&gt;():</span><br><span class="line">ReadWriteProperty&lt;Any?, T&gt; = NotNullSingleValueVar()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>重新实现Application单例化,可以在app的任何地方去修改这个值，因为如果我们使用 Delegates.notNull() ，属性必须是var的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class App : Application() &#123;</span><br><span class="line">  companion object &#123;</span><br><span class="line">    var instance: App by Delegates.notNull()</span><br><span class="line">  &#125;</span><br><span class="line">  override fun onCreate() &#123;</span><br><span class="line">    super.onCreate()</span><br><span class="line">    instance = this</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">上述可以任何地方修改问题，解决办法使用下面的委托，只能修改一次</span><br><span class="line">companion object &#123;</span><br><span class="line">var instance: App by DelegatesExt.notNullSingleValue()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/03/23/Kotlin-for-Android-三/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/23/Kotlin-for-Android-三/" itemprop="url">Kotlin for Android (三)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-23T16:34:27+08:00">
                2018-03-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/03/23/Kotlin-for-Android-三/" class="leancloud_visitors" data-flag-title="Kotlin for Android (三)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h4><img src="http://p4n1d4izv.bkt.clouddn.com/images/operation1.png">
<img src="http://p4n1d4izv.bkt.clouddn.com/images/operation2.png">
<ul>
<li><p>操作符在Adapter中的应用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//    val size: Int get() = dailyForecast.size</span><br><span class="line">override fun getItemCount(): Int = items.size</span><br><span class="line"></span><br><span class="line">//    operator fun get(position: Int) = dailyForecast[position]</span><br><span class="line">override fun onBindViewHolder(holder: VH, position: Int) &#123;</span><br><span class="line">    with(items[position]) &#123;</span><br><span class="line">//   with(items.dailyForecast[position]) &#123;</span><br><span class="line">       holder.textView.text = &quot;$date - $description - $high - $low&quot;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>扩展函数中的操作符,访问ViewGroup中的View</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">operator fun ViewGroup.get(position: Int): View = getChildAt(pos</span><br><span class="line">ition)</span><br><span class="line"></span><br><span class="line">val container: ViewGroup = find(R.id.container)</span><br><span class="line">val view = container[2]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="使Forecast-list可点击"><a href="#使Forecast-list可点击" class="headerlink" title="使Forecast list可点击"></a>使Forecast list可点击</h4><ul>
<li><p>item_forecast.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout</span><br><span class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:padding=&quot;@dimen/spacing_xlarge&quot;</span><br><span class="line">    android:background=&quot;?attr/selectableItemBackground&quot;</span><br><span class="line">    android:gravity=&quot;center_vertical&quot;</span><br><span class="line">    android:orientation=&quot;horizontal&quot;&gt;</span><br><span class="line">    &lt;ImageView</span><br><span class="line">        android:id=&quot;@+id/icon&quot;</span><br><span class="line">        android:layout_width=&quot;48dp&quot;</span><br><span class="line">        android:layout_height=&quot;48dp&quot;</span><br><span class="line">        tools:src=&quot;@mipmap/ic_launcher&quot;/&gt;</span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_weight=&quot;1&quot;</span><br><span class="line">        android:layout_marginLeft=&quot;@dimen/spacing_xlarge&quot;</span><br><span class="line">        android:layout_marginRight=&quot;@dimen/spacing_xlarge&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot;&gt;</span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/date&quot;</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:textAppearance=&quot;@style/TextAppearance.AppCompat.Medium&quot;</span><br><span class="line">            tools:text=&quot;May 14, 2015&quot;/&gt;</span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/description&quot;</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:textAppearance=&quot;@style/TextAppearance.AppCompat.Caption&quot;</span><br><span class="line">            tools:text=&quot;Light Rain&quot;/&gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:gravity=&quot;center_horizontal&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot;&gt;</span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/maxTemperature&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:textAppearance=&quot;@style/TextAppearance.AppCompat.Medium&quot;</span><br><span class="line">            tools:text=&quot;30&quot;/&gt;</span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/minTemperature&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:textAppearance=&quot;@style/TextAppearance.AppCompat.Caption&quot;</span><br><span class="line">            tools:text=&quot;15&quot;/&gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加iconUrl参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">data class Forecast(val date: String, val description: String,</span><br><span class="line">val high: Int, val low: Int, val iconUrl: St</span><br><span class="line">ring)</span><br><span class="line"></span><br><span class="line">在 ForecastDataMapper 中：</span><br><span class="line">private fun convertForecastItemToDomain(forecast: Forecast): Mod</span><br><span class="line">elForecast &#123;</span><br><span class="line">return ModelForecast(convertDate(forecast.dt),</span><br><span class="line">forecast.weather[0].description, forecast.temp.max.t</span><br><span class="line">oInt(),</span><br><span class="line">forecast.temp.min.toInt(), generateIconUrl(forecast.</span><br><span class="line">weather[0].icon))</span><br><span class="line">&#125;</span><br><span class="line">private fun generateIconUrl(iconCode: String): String</span><br><span class="line">= &quot;http://openweathermap.org/img/w/$iconCode.png&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Adapter添加点击事件,对应操作符invoke，可以有两种方式调用</p>
<blockquote>
<p>itemClick.invoke(forecast)<br>itemClick(forecast)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface OnItemClickListener &#123;</span><br><span class="line">        //对应的操作符为 itemClick(forecast)</span><br><span class="line">        operator fun invoke(forecast: Forecast)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>新的Adapter,重新设置布局，绑定数据，设置监听</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">class ForecastListAdapter(val items: ForecastList, val itemClick: OnItemClickListener) : RecyclerView.Adapter&lt;ForecastListAdapter.VH&gt;() &#123;</span><br><span class="line">    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): VH &#123;</span><br><span class="line">        val view = LayoutInflater.from(parent.context).inflate(R.layout.item_forecast, parent, false)</span><br><span class="line">        return VH(view, itemClick)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //    val size: Int get() = dailyForecast.size</span><br><span class="line">    override fun getItemCount(): Int = items.size</span><br><span class="line"></span><br><span class="line">    override fun onBindViewHolder(holder: VH, position: Int) &#123;</span><br><span class="line">        bindForecast(position, holder)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //    operator fun get(position: Int) = dailyForecast[position]</span><br><span class="line">    private fun bindForecast(position: Int, holder: VH) &#123;</span><br><span class="line">        with(items[position]) &#123;</span><br><span class="line">            // with(items.dailyForecast[position]) &#123;</span><br><span class="line">//            holder.itemView.date.text = &quot;$date - $description - $high - $low&quot;</span><br><span class="line">            holder.bindForecast(this)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class VH(itemView: View, val itemClick: OnItemClickListener) : RecyclerView.ViewHolder(itemView) &#123;</span><br><span class="line">        private val iconView: ImageView</span><br><span class="line">        private val dateView: TextView</span><br><span class="line">        private val descriptionView: TextView</span><br><span class="line">        private val maxTemperatureView: TextView</span><br><span class="line">        private val minTemperatureView: TextView</span><br><span class="line"></span><br><span class="line">        init &#123;</span><br><span class="line">            iconView = itemView.findViewById(R.id.icon)</span><br><span class="line">            dateView = itemView.findViewById(R.id.date)</span><br><span class="line">            descriptionView = itemView.findViewById(R.id.description)</span><br><span class="line">            maxTemperatureView = itemView.findViewById(R.id.maxTemperature)</span><br><span class="line">            minTemperatureView = itemView.findViewById(R.id.minTemperature)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fun bindForecast(forecast: Forecast) &#123;</span><br><span class="line">            with(forecast) &#123;</span><br><span class="line">                Picasso.with(itemView.context).load(iconUrl).into(iconView)</span><br><span class="line">                dateView.text = date</span><br><span class="line">                descriptionView.text = description</span><br><span class="line">                maxTemperatureView.text = high.toString()</span><br><span class="line">                minTemperatureView.text = low.toString()</span><br><span class="line">                itemView.setOnClickListener &#123; itemClick(this) &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public interface OnItemClickListener &#123;</span><br><span class="line">        //对应的操作符为 itemClick(forecast)</span><br><span class="line">        operator fun invoke(forecast: Forecast)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置Adapter,创建一个匿名内部类，我们去创建了一个实现了刚刚创建的接口的对象。需要使用另一个强大的函数式编程的特性，把这些代码转换得更简单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">uiThread &#123;</span><br><span class="line">                recyclerView.adapter = ForecastListAdapter(result, object : ForecastListAdapter.OnItemClickListener &#123;</span><br><span class="line">                    override fun invoke(forecast: Forecast) &#123;</span><br><span class="line">                        toast(forecast.date)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<img src="http://p4n1d4izv.bkt.clouddn.com/images/recyclerview-click.gif">
<ul>
<li>ViewExtensions.kt<blockquote>
<p>通过 ctx 这个属性来返回context，但是在View中缺少这个属<br>性。所以我们要创建一个新的名叫 ViewExtensions.kt 文件来代<br>替 ui.utils ，然后增加这个扩展属性<br>val View.ctx: Context<br>get() = context<br>从现在开始，任何View都可以使用这个属性了。这个不是必须的，因为你可以使用<br>扩展的context属性，但是我觉得如果我们使用 ctx 的话在其它类中也会更有连贯<br>性。而且，这是一个很好的怎么去使用扩展属性的例子</p>
</blockquote>
<h4 id="Lambdas"><a href="#Lambdas" class="headerlink" title="Lambdas"></a>Lambdas</h4></li>
<li><p>一个lambda表达式通过参数的形式被定义在箭头的左边（被圆括号包围），然后在箭头的右边返回结果值,接收一个View，然后返回一个Unit</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fun setOnClickListener(listener: (View) -&gt; Unit)</span><br><span class="line"></span><br><span class="line">view.setOnClickListener(&#123; view -&gt; toast(&quot;Click&quot;)&#125;)</span><br><span class="line"></span><br><span class="line">如果参数没有使用，可以省略参数</span><br><span class="line">view.setOnClickListener(&#123; toast(&quot;Click&quot;) &#125;)</span><br><span class="line"></span><br><span class="line">如果函数的最后一个参数是函数，可以把这个函数参数移到括号外</span><br><span class="line">view.setOnClickListener() &#123; toast(&quot;Click&quot;) &#125;</span><br><span class="line"></span><br><span class="line">这个函数只有一个参数，省略圆括号</span><br><span class="line">view.setOnClickListener &#123; toast(&quot;Click&quot;) &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>所以MainActivity中设置ForecaAdapter</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">recyclerView.adapter = ForecastListAdapter(result) &#123; forecast -&gt; toast(forecast.date) &#125;</span><br><span class="line"></span><br><span class="line">如果这个函数只有一个参数，可以使用it引用，不用去指定左边的参数</span><br><span class="line">val adapter = ForecastListAdapter(result) &#123; toast(it.date) &#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<h4 id="扩展语言"><a href="#扩展语言" class="headerlink" title="扩展语言"></a>扩展语言</h4><ul>
<li><p><code>with</code>函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@kotlin.internal.InlineOnly</span><br><span class="line">public inline fun &lt;T, R&gt; with(receiver: T, block: T.() -&gt; R): R &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    return receiver.block()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第二个参数是一个函数，可以把他放在圆括号外面，所以可以创建一个代码块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> with(forecast) &#123;</span><br><span class="line">Picasso.with(itemView.ctx).load(iconUrl).into(iconView)</span><br><span class="line">dateView.text = date</span><br><span class="line">descriptionView.text = description</span><br><span class="line">maxTemperatureView.text = &quot;$high&quot;</span><br><span class="line">minTemperatureView.text = &quot;$low&quot;</span><br><span class="line">itemView.setOnClickListener &#123; itemClick(this) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>内联函数<br>内联函数与普通的函数有点不同。一个内联函数会在编译的时候被替换<br>掉，而不是真正的方法调用。这在一些情况下可以减少内存分配和运行时<br>开销。举个例子，如果我们有一个函数，只接收一个函数作为它的参数。<br>如果是一个普通的函数，内部会创建一个含有那个函数的对象。另一方<br>面，内联函数会把我们调用这个函数的地方替换掉，所以它不需要为此生<br>成一个内部的对象</p>
</blockquote>
</li>
<li><p>判断版本执行代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">inline fun supportsLollipop(code: () -&gt; Unit) &#123;</span><br><span class="line">if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">code()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">它只是检查版本，然后如果满足条件则去执行。现在我们可以这么做：</span><br><span class="line">supportsLollipop &#123;</span><br><span class="line">window.setStatusBarColor(Color.BLACK)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>可见性修饰符</p>
<blockquote>
<p>protected<br>这个修饰符只能被用在类或者接口中的成员上。一个包成员不能被定义为 protected ,定义在一个成员中，就与Java中的方式一样了：它可以被成员自己和继承它的成员可见（比如，类和它的子类）</p>
</blockquote>
<blockquote>
<p>internal<br>如果是一个定义为 internal 的包成员的话，对所在的整个 module 可见。如果<br>它是一个其它领域的成员，它就需要依赖那个领域的可见性了。比如，如果我们写<br>了一个 private 类，那么它的 internal 修饰的函数的可见性就会限制与它所在<br>的这个类的可见性。我们可以访问同一个 module 中的 internal 修饰的类，但是不能访问其它 module 的</p>
</blockquote>
</li>
<li>构造器<blockquote>
<p>所有构造函数默认都是 public 的，它们类是可见的，可以被其它地方使用。我们<br>也可以使用这个语法来把构造函数修改为 private ：<br><code>class C private constructor(a: Int) { ... }</code></p>
</blockquote>
</li>
<li><p>布局中的\&lt;include>增加内嵌布局,需要手动import</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import kotlinx.android.synthetic.activity_main.*</span><br><span class="line">import kotlinx.android.synthetic.content_main.*</span><br></pre></td></tr></table></figure>
</li>
<li><p>绑定一个xml中的view到另一个view。唯一不同的就是需要 import ：<br><code>import kotlinx.android.synthetic.view_item.view.*</code></p>
</li>
<li><p>在Adapter中可以简化代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import kotlinx.android.synthetic.main.item_forecast.view.*</span><br><span class="line"></span><br><span class="line">class VH(itemView: View, val itemClick: (Forecast) -&gt; Unit) : RecyclerView.ViewHolder(itemView) &#123;</span><br><span class="line">        fun bindForecast(forecast: Forecast) &#123;</span><br><span class="line">            with(forecast) &#123;</span><br><span class="line">                Picasso.with(itemView.context).load(iconUrl).into(itemView.icon)</span><br><span class="line">                itemView.date.text = date</span><br><span class="line">                itemView.description.text = description</span><br><span class="line">                itemView.maxTemperature.text = high.toString()</span><br><span class="line">                itemView.minTemperature.text = low.toString()</span><br><span class="line">                itemView.setOnClickListener &#123; itemClick(this) &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/03/23/Kotlin-for-Android-二/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/23/Kotlin-for-Android-二/" itemprop="url">Kotlin for Android (二)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-23T10:47:00+08:00">
                2018-03-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kotlin/" itemprop="url" rel="index">
                    <span itemprop="name">Kotlin</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/23/Kotlin-for-Android-二/" class="leancloud_visitors" data-flag-title="Kotlin for Android (二)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h4 id="Anko"><a href="#Anko" class="headerlink" title="Anko"></a><a href="https://github.com/Kotlin/anko" target="_blank" rel="noopener">Anko</a></h4><ul>
<li>Anko Commons：一个轻量级的库，里面包含了intents，对话框，日志等帮助类</li>
<li>Anko Layouts：用于编写动态Android布局的快速且类型安全的方法</li>
<li>Anko SQLite：查询适用于Android SQLite的DSL和分析器集合</li>
<li>Anko Coroutines：基于kotlinx.coroutines库的实用程序</li>
<li>简化获取RecyclerView<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val forecastList: RecyclerView = find(R.id.recyclerView)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="扩展函数"><a href="#扩展函数" class="headerlink" title="扩展函数"></a>扩展函数</h4><p>扩展函数数是指在一个类上增加一种新的行为，甚至我们没有这个类代码的访问权<br>限。这是一个在缺少有用函数的类上扩展的方法。在Java中，通常会实现很多带有<br>static方法的工具类。Kotlin中扩展函数的一个优势是我们不需要在调用方法的时候<br>把整个对象当作参数传入。扩展函数表现得就像是属于这个类的一样，而且我们可<br>以使用 this 关键字和调用所有public方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fun Context.toastF(message: CharSequence,duration: Int=Toast.LENGTH_SHORT)&#123;</span><br><span class="line">   Toast.makeText(this, &quot;$message&quot;, duration).show()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>Anko已经扩展toast函数，提供了CharSequence,(resource id)Int的函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">toast(R.string.app_name)</span><br><span class="line">longToast(&quot;longToast&quot;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>扩展函数并不是真正地修改了原来的类，它是以静态导入的方式来实现的。扩展函数可以被声明在任何文件中，通用的实践是把一系列有关的函数放在一个新建的文件里</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var TextView.text: CharSequence</span><br><span class="line">   get() = getText()</span><br><span class="line">   set(v) = setText(v)</span><br></pre></td></tr></table></figure>
</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/03/23/Kotlin-for-Android-二/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/03/22/Kotlin-for-Android-一/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/22/Kotlin-for-Android-一/" itemprop="url">Kotlin for Android (一)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-22T23:43:00+08:00">
                2018-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kotlin/" itemprop="url" rel="index">
                    <span itemprop="name">Kotlin</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/22/Kotlin-for-Android-一/" class="leancloud_visitors" data-flag-title="Kotlin for Android (一)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h4 id="介绍Kotlin"><a href="#介绍Kotlin" class="headerlink" title="介绍Kotlin"></a>介绍Kotlin</h4><ul>
<li>编写代码量少</li>
<li>更加安全：Kotlin编译时期就处理了各种null的情况，避免了执行时异常。如果一个对象可以是null，则我们需要明确地指定它，然后在使用它之前检查它是否是null</li>
<li>它是函数式的：Kotlin是基于面向对象的语言，它使用了很多函数式编程的概念，比如，使用lambda表达式来更方便地解决问题。其中一个很棒的特性就是Collections的处理方式</li>
<li>它可以扩展函数：可以扩展类的更多的特性，甚至我们没有权限去访问这个类中的代码</li>
<li>它是高度互操作性的：你可以继续使用所有的你用Java写的代码和库，因为两个语言之间的互操作性是完美的。可以在一个项目中使用Kotlin和Java两种语言混合编程</li>
</ul>
<h4 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h4><h5 id="Expresiveness-可读性"><a href="#Expresiveness-可读性" class="headerlink" title="Expresiveness 可读性"></a>Expresiveness 可读性</h5><ul>
<li><p>POJO</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Artist &#123;</span><br><span class="line">private long id;</span><br><span class="line">private String name;</span><br><span class="line">private String url;</span><br><span class="line">private String mbid;</span><br><span class="line">public long getId() &#123;</span><br><span class="line">return id;</span><br><span class="line">&#125;</span><br><span class="line">public void setId(long id) &#123;</span><br><span class="line">this.id = id;</span><br><span class="line">&#125;</span><br><span class="line">···</span><br></pre></td></tr></table></figure>
</li>
<li><p>Kotlin中创建数据类Artist.kt,自动生成所有属性和访问器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data class Artist(var id: Long, var name: String, var url: String, var mbid: String)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="空安全"><a href="#空安全" class="headerlink" title="空安全"></a>空安全</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> //编译不通过，非空类不能为null</span><br><span class="line"> var artist:Artist=null</span><br><span class="line"> </span><br><span class="line"> //安全调用操作符? 明确地指定一个对象是否能为空</span><br><span class="line"> var artist: Artist? = null</span><br><span class="line"> </span><br><span class="line">// 无法编译, artist可能是null，需要进行处理</span><br><span class="line">// artist.hashCode()</span><br><span class="line"></span><br><span class="line">//在artist!=null时调用</span><br><span class="line">artist?.hashCode()</span><br><span class="line"></span><br><span class="line">// 判空</span><br><span class="line">if(artist!=null)&#123;</span><br><span class="line">  artist.hashCode()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//给定在null时的替代者</span><br><span class="line">val name=artist?.name?:&quot;empty&quot;</span><br><span class="line"></span><br><span class="line">//确保artist不是null的情况下调用，否在抛异常KotlinNullPointerException</span><br><span class="line">artist!!.hashCode()</span><br></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/03/22/Kotlin-for-Android-一/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/03/20/RxJava2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/20/RxJava2/" itemprop="url">RxJava2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-20T15:14:00+08:00">
                2018-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/20/RxJava2/" class="leancloud_visitors" data-flag-title="RxJava2">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h5 id="RxJava2"><a href="#RxJava2" class="headerlink" title="RxJava2"></a>RxJava2</h5><p>RxJava是Java VM响应式编程扩展的实现，扩展了观察者模式，通过操作符对数据事件流操作，来编写异步和基于事件的程序，从而不用关心同步，线程安全并发等问题</p>
<ul>
<li>app/build.gradle<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">implementation &apos;io.reactivex.rxjava2:rxjava:2.1.9&apos;</span><br><span class="line">implementation &apos;io.reactivex.rxjava2:rxandroid:2.0.2&apos;</span><br><span class="line"></span><br><span class="line">//retrofit</span><br><span class="line">implementation &apos;com.squareup.retrofit2:retrofit:2.3.0&apos;</span><br><span class="line">//Gson converter</span><br><span class="line">implementation &apos;com.squareup.retrofit2:converter-gson:2.3.0&apos;</span><br><span class="line">//RxJava2 Adapter</span><br><span class="line">implementation &apos;com.jakewharton.retrofit:retrofit2-rxjava2-adapter:1.0.0&apos;</span><br><span class="line">//okhttp</span><br><span class="line">implementation &apos;com.squareup.okhttp3:okhttp:3.8.1&apos;</span><br><span class="line">implementation &apos;com.squareup.okhttp3:logging-interceptor:3.6.0&apos;</span><br></pre></td></tr></table></figure>
</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/03/20/RxJava2/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/03/16/Data-Binding/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/16/Data-Binding/" itemprop="url">Data Binding</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-16T13:38:00+08:00">
                2018-03-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/16/Data-Binding/" class="leancloud_visitors" data-flag-title="Data Binding">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h5 id="Data-Binding-Library"><a href="#Data-Binding-Library" class="headerlink" title="Data Binding Library"></a>Data Binding Library</h5><p>数据绑定库编写声明式布局，尽量减少绑定应用程序逻辑和布局所需的代码，减少布局绑定相关代码</p>
<ul>
<li><p>build environment</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">android&#123;</span><br><span class="line">...</span><br><span class="line">     dataBinding &#123;</span><br><span class="line">        enabled = true</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Data Binding Compiler V2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android.databinding.enableV2=true</span><br><span class="line">向后不兼容</span><br></pre></td></tr></table></figure>
</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/03/16/Data-Binding/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/03/13/Dagger/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/13/Dagger/" itemprop="url">Dagger</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-13T00:12:00+08:00">
                2018-03-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/13/Dagger/" class="leancloud_visitors" data-flag-title="Dagger">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h5 id="Dagger"><a href="#Dagger" class="headerlink" title="Dagger"></a>Dagger</h5><p>依赖注入（Dependency Injection），简称DI，又叫控制反转（Inversion of Control），简称IOC<br>当一个类的实例需要另一个类的实例，在传统的设计中，通常由调用者来创建被调用者的实例，然而依赖注入的方式，创建被调用者不再由调用者创建实例，创建被调用者的实例的工作由IOC容器来完成，然后注入到调用者。因此也被称为依赖注入</p>
<ul>
<li>API<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public @interface Component &#123;</span><br><span class="line">    Class&lt;?&gt;[] modules() default &#123;&#125;;</span><br><span class="line">    Class&lt;?&gt;[] dependencies() default &#123;&#125;;</span><br><span class="line">    @Target(TYPE)</span><br><span class="line">    @Documented</span><br><span class="line">    @interface Builder &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public @interface Subcomponent &#123;</span><br><span class="line">    Class&lt;?&gt;[] modules() default &#123;&#125;;</span><br><span class="line">    @Target(TYPE)</span><br><span class="line">    @Documented</span><br><span class="line">    @interface Builder &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public @interface Module &#123;</span><br><span class="line">    Class&lt;?&gt;[] includes() default &#123;&#125;;</span><br><span class="line">    @Beta</span><br><span class="line">    Class&lt;?&gt;[] subcomponents() default &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public @interface Provides &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public @interface MapKey &#123;</span><br><span class="line">    boolean unwrapValue() default true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public interface Lazy&lt;T&gt; &#123;</span><br><span class="line">    T get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/03/13/Dagger/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/03/10/ConstraintLayout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/10/ConstraintLayout/" itemprop="url">ConstraintLayout</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-10T02:16:00+08:00">
                2018-03-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/10/ConstraintLayout/" class="leancloud_visitors" data-flag-title="ConstraintLayout">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <ul>
<li><p>引入constraint-layout</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">        maven &#123;</span><br><span class="line">            url &apos;https://maven.google.com&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">compile &apos;com.android.support.constraint:constraint-layout:1.1.0-beta5&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">layout_constraintLeft_toLeftOf</span><br><span class="line">左对齐</span><br><span class="line">layout_constraintLeft_toRightOf</span><br><span class="line">左边和约束控件的右边对齐</span><br><span class="line">layout_constraintRight_toLeftOf</span><br><span class="line">右边在某组件的左边</span><br><span class="line">layout_constraintRight_toRightOf</span><br><span class="line">右边在某组件的右边</span><br><span class="line">layout_constraintTop_toTopOf</span><br><span class="line">上边和某组件的上边对其</span><br><span class="line">layout_constraintTop_toBottomOf</span><br><span class="line">上边在某组件的下边</span><br><span class="line">layout_constraintBottom_toTopOf</span><br><span class="line">下边在某组件的上边</span><br><span class="line">layout_constraintBottom_toBottomOf</span><br><span class="line">下边在某组件的下边</span><br><span class="line">layout_constraintBaseline_toBaselineOf</span><br><span class="line">组件的基线位置和某组件的基线位置对其（很少用）</span><br><span class="line">layout_constraintStart_toEndOf</span><br><span class="line">layout_constraintStart_toStartOf</span><br><span class="line">layout_constraintEnd_toStartOf</span><br><span class="line">layout_constraintEnd_toEndOf</span><br><span class="line">属性的值有两种，一种是同层级组件ID，还有就是parent，当值为parent时即是相对于父布局进行定位</span><br></pre></td></tr></table></figure>
</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/03/10/ConstraintLayout/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/03/09/CoordinatorLayout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/09/CoordinatorLayout/" itemprop="url">CoordinatorLayout</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-09T10:33:00+08:00">
                2018-03-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/09/CoordinatorLayout/" class="leancloud_visitors" data-flag-title="CoordinatorLayout">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h4 id="CoordinatorLayout"><a href="#CoordinatorLayout" class="headerlink" title="CoordinatorLayout"></a>CoordinatorLayout</h4><p>Material风格布局，包含在support Library中，结合AppbarLayout,CollapsingToolbarLayout等可达到MD设计风格布局</p>
<ul>
<li>build.gradle<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def SUPPORT = &quot;26.1.0&quot;</span><br><span class="line">dependencies &#123;</span><br><span class="line">  implementation &apos;com.android.support:appcompat-v7:26.1.0&apos;</span><br><span class="line">    implementation &apos;com.android.support.constraint:constraint-layout:1.0.2&apos;</span><br><span class="line">    implementation &quot;com.android.support:design:$SUPPORT&quot;</span><br><span class="line">    implementation &quot;com.android.support:cardview-v7:$SUPPORT&quot;</span><br><span class="line">    implementation &quot;com.android.support:recyclerview-v7:$SUPPORT&quot;</span><br><span class="line">    implementation &apos;de.hdodenhof:circleimageview:1.3.0&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/03/09/CoordinatorLayout/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://willkernel.github.io/2018/03/09/NDK/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="willkernel">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="willkernel">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/09/NDK/" itemprop="url">NDK</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-09T01:04:00+08:00">
                2018-03-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/09/NDK/" class="leancloud_visitors" data-flag-title="NDK">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="willkernel" />
            
              <p class="site-author-name" itemprop="name">willkernel</p>
              <p class="site-description motion-element" itemprop="description">Lifelong learning</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/willkernel" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          
            <div class="cc-license motion-element" itemprop="license">
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
                <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
              </a>
            </div>
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.wanandroid.com/" title="wanandroid" target="_blank">wanandroid</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://drakeet.me/" title="Drakeet" target="_blank">Drakeet</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://weishu.me/" title="Weishu" target="_blank">Weishu</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://gityuan.com/" title="Gityuan" target="_blank">Gityuan</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://daimajia.com/" title="Daimajia" target="_blank">Daimajia</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://kymjs.com/" title="Kymjs" target="_blank">Kymjs</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://droidyue.com/" title="droidyue" target="_blank">droidyue</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.520monkey.com/" title="尼古拉斯.赵四" target="_blank">尼古拉斯.赵四</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://yifeiyuan.me/" title="程序员非猿" target="_blank">程序员非猿</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.piasy.com/" title="Piasy" target="_blank">Piasy</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://jakewharton.com/" title="Jake Wharton" target="_blank">Jake Wharton</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://a.codekk.com/" title="codeKK" target="_blank">codeKK</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">willkernel</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("rLYe00bwlVwdVl482yiXQCxJ-gzGzoHsz", "FHEYTPBB8u6YYykLSh4KhfiG");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

</body>
</html>
